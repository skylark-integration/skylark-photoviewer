/**
 * skylark-photoviewer - A version of dat.gui.js  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-photoviewer/
 * @license MIT
 */
define(["skylark-domx-plugins-pictures/viewer","skylark-domx-plugins-panels/floating","./domq","./defaults","./constants","./utilities"],function(t,i,e,o,s,a){"use strict";class h{constructor(t,i,s){this.options=e.extend(!0,{},o,i),i&&e.isArray(i.footerToolbar)&&(this.options.footerToolbar=i.footerToolbar),i&&e.isArray(i.headerToolbar)&&(this.options.headerToolbar=i.headerToolbar),this.$el=e(s),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isDoResize=!1,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(t,this.options)}init(t,i){this.groupData=t,this.groupIndex=i.index,s.PUBLIC_VARS.zIndex=0===s.PUBLIC_VARS.zIndex?i.zIndex:s.PUBLIC_VARS.zIndex;const e=t[this.groupIndex].src;this.open(),this.loadImage(e)}_createBtns(t){const i=["minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight"];let o="";return e.each(t,(t,e)=>{const a=`${s.NS}-button ${s.NS}-button-${e}`;i.indexOf(e)>=0?o+=`<button class="${a}" title="${this.options.i18n[e]}">\n          ${this.options.icons[e]}\n          </button>`:this.options.customButtons[e]&&(o+=`<button class="${a}" title="${this.options.customButtons[e].title||""}">\n          ${this.options.customButtons[e].text}\n          </button>`)}),o}_createTitle(){return this.options.title?`<div class="${s.NS}-title"></div>`:""}_createTemplate(){return`<div class="${s.NS}-modal" tabindex="0">\n        <div class="${s.NS}-inner">\n          <div class="${s.NS}-header">\n            <div class="${s.NS}-toolbar ${s.NS}-toolbar-header">\n            ${this._createBtns(this.options.headerToolbar)}\n            </div>\n            ${this._createTitle()}\n          </div>\n          <div class="${s.NS}-stage">\n            <img class="${s.NS}-image" src="" alt="" />\n          </div>\n          <div class="${s.NS}-footer">\n            <div class="${s.NS}-toolbar ${s.NS}-toolbar-footer">\n            ${this._createBtns(this.options.footerToolbar)}\n            </div>\n          </div>\n        </div>\n      </div>`}build(){const o=this._createTemplate(),a=e(o);this.$photoviewer=a,this.$stage=a.find(s.CLASS_NS+"-stage"),this.$title=a.find(s.CLASS_NS+"-title"),this.$image=a.find(s.CLASS_NS+"-image"),this.$close=a.find(s.CLASS_NS+"-button-close"),this.$maximize=a.find(s.CLASS_NS+"-button-maximize"),this.$minimize=a.find(s.CLASS_NS+"-button-minimize"),this.$zoomIn=a.find(s.CLASS_NS+"-button-zoomIn"),this.$zoomOut=a.find(s.CLASS_NS+"-button-zoomOut"),this.$actualSize=a.find(s.CLASS_NS+"-button-actualSize"),this.$fullscreen=a.find(s.CLASS_NS+"-button-fullscreen"),this.$rotateLeft=a.find(s.CLASS_NS+"-button-rotateLeft"),this.$rotateRight=a.find(s.CLASS_NS+"-button-rotateRight"),this.$prev=a.find(s.CLASS_NS+"-button-prev"),this.$next=a.find(s.CLASS_NS+"-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$photoviewer.css("z-index",s.PUBLIC_VARS.zIndex),this.options.dragHandle&&this.options.dragHandle!==s.CLASS_NS+"-modal"?this.dragHandle=this.$photoviewer.find(this.options.dragHandle):this.dragHandle=this.$photoviewer,e(this.options.appendTo).eq(0).append(this.$photoviewer),this._window=new i(this.$photoviewer[0],{selectors:{headerPane:"",contentPane:"",footerPane:"",titlebar:"",buttons:{fullscreen:".photoviewer-button-fullscreen",maximize:".photoviewer-button-maximize",minimize:".photoviewer-button-minimize",close:".photoviewer-button-close"}},classes:{maximize:s.NS+"-maximize"},fixedContent:!0,initMaximized:!1,movable:{dragHandle:this.options.dragHandle,dragCancel:s.CLASS_NS+"-button"},resizable:{minWidth:320,minHeight:320,border:{classes:{all:`${s.NS}-resizable-handle`,top:`${s.NS}-resizable-handle-n`,left:`${s.NS}-resizable-handle-w`,right:`${s.NS}-resizable-handle-e`,bottom:`${s.NS}-resizable-handle-s`,topLeft:`${s.NS}-resizable-handle-nw`,topRight:`${s.NS}-resizable-handle-ne`,bottomLeft:`${s.NS}-resizable-handle-sw`,bottomRight:`${s.NS}-resizable-handle-se`}}}}),this._imager=new t(this.$stage[0],{ratioThreshold:this.options.ratioThreshold,minRatio:this.options.minRatio,maxRatio:this.options.maxRatio,movable:!0,classes:{grab:"is-grab",loader:"${ Constants.NS }-loader"}}),this._addEvents(),this._addCustomButtonEvents(),this.$photoviewer.on("resized",()=>{this._imager.resize()})}open(){if(this._triggerHook("beforeOpen",this),this.options.multiInstances||e(s.CLASS_NS+"-modal").eq(0).remove(),!e(s.CLASS_NS+"-modal").length&&this.options.fixedContent&&(e("html").css({overflow:"hidden"}),a.hasScrollbar())){const t=a.getScrollbarWidth();t&&e("html").css({"padding-right":t})}this.build(),this.setModalPos(this.$photoviewer),this.$photoviewer.get(0).focus(),this._triggerHook("opened",this)}close(){this._window.close()}setModalPos(t){const i=s.$W.width(),e=s.$W.height(),o=s.$D.scrollLeft(),a=s.$D.scrollTop(),h=this.options.modalWidth,n=this.options.modalHeight;this.options.initMaximized?(t.addClass(s.NS+"-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:h,height:n,left:(i-h)/2+o+"px",top:(e-n)/2+a+"px"})}setModalSize(t){const i=s.$W.width(),e=s.$W.height(),o=s.$D.scrollLeft(),a=s.$D.scrollTop(),h={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},n=t.width+parseFloat(h.left)+parseFloat(h.right)+parseFloat(h.borderLeft)+parseFloat(h.borderRight),r=t.height+parseFloat(h.top)+parseFloat(h.bottom)+parseFloat(h.borderTop)+parseFloat(h.borderBottom),l=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,d=Math.min(i/(n*l),e/(r*l),1);let p=Math.max(n*d,this.options.modalWidth),m=Math.max(r*d,this.options.modalHeight);const g={width:(p=this.options.fixedModalSize?this.options.modalWidth:Math.round(p))+"px",height:(m=this.options.fixedModalSize?this.options.modalHeight:Math.round(m))+"px",left:(i-p)/2+o+"px",top:(e-m)/2+a+"px"};this.options.initAnimation?this.$photoviewer.animate(g,400,"ease-in-out",()=>{this.setImageSize(t)}):(this.$photoviewer.css(g),this.setImageSize(t)),this.isOpened=!0}setImageSize(t){this._imager.setImageSize(t)}loadImage(t,i,e){this._imager.loadImage(t,t=>{this.setModalSize(t),i&&i.call()},e),this.options.title&&this.setImageTitle(t)}setImageTitle(t){const i=this.groupData[this.groupIndex].title||a.getImageNameFromUrl(t);this.$title.html(i)}jump(t){this._triggerHook("beforeChange",[this,this.groupIndex]),this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)}jumpTo(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImage(this.groupData[t].src,()=>{this._triggerHook("changed",[this,t])},()=>{this._triggerHook("changed",[this,t])})}zoom(t,i,e){this._imager.zoom(t,i,e)}zoomTo(t,i,e){this._imager.zoomTo(t,i,e)}rotate(t){this._imager.rotate(t)}rotateTo(t){this._imager.rotateTo(t)}resize(){return this._imager.resize()}maximize(){this._window.maximize()}fullscreen(){this._window.fullscreen()}_keydown(t){if(!this.options.keyboard)return!1;const i=t.keyCode||t.which||t.charCode;t.ctrlKey||t.metaKey,t.altKey||t.metaKey;switch(i){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 81:this.close()}}_addEvents(){this.$zoomIn.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$zoomOut.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$actualSize.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$prev.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.jump(-1)}),this.$next.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.jump(1)}),this.$rotateLeft.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.rotate(-90)}),this.$rotateRight.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.rotate(90)}),this.$photoviewer.off(s.KEYDOWN_EVENT+s.EVENT_NS).on(s.KEYDOWN_EVENT+s.EVENT_NS,t=>{this._keydown(t)})}_addCustomButtonEvents(){for(const t in this.options.customButtons)this.$photoviewer.find(s.CLASS_NS+"-button-"+t).off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,i=>{this.options.customButtons[t].click.apply(this,[this,i])})}_triggerHook(t,i){this.options.callbacks[t]&&this.options.callbacks[t].apply(this,e.isArray(i)?i:[i])}}return window.PhotoViewer=h,h});
//# sourceMappingURL=sourcemaps/core.js.map
