/**
 * skylark-photoviewer - A version of dat.gui.js  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-photoviewer/
 * @license MIT
 */
define(["skylark-domx-plugins-pictures/viewer","./domq","./defaults","./constants","./utilities","./window"],function(t,i,o,s,e,h){"use strict";class a{constructor(t,s,e){this.options=i.extend(!0,{},o,s),s&&i.isArray(s.footerToolbar)&&(this.options.footerToolbar=s.footerToolbar),s&&i.isArray(s.headerToolbar)&&(this.options.headerToolbar=s.headerToolbar),this.$el=i(e),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isDoResize=!1,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(t,this.options)}init(t,i){this.groupData=t,this.groupIndex=i.index,s.PUBLIC_VARS.zIndex=0===s.PUBLIC_VARS.zIndex?i.zIndex:s.PUBLIC_VARS.zIndex;const o=t[this.groupIndex].src;this.open(),this.loadImage(o)}_createBtns(t){const o=["minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight"];let e="";return i.each(t,(t,i)=>{const h=`${s.NS}-button ${s.NS}-button-${i}`;o.indexOf(i)>=0?e+=`<button class="${h}" title="${this.options.i18n[i]}">\n          ${this.options.icons[i]}\n          </button>`:this.options.customButtons[i]&&(e+=`<button class="${h}" title="${this.options.customButtons[i].title||""}">\n          ${this.options.customButtons[i].text}\n          </button>`)}),e}_createTitle(){return this.options.title?`<div class="${s.NS}-title"></div>`:""}_createTemplate(){return`<div class="${s.NS}-modal" tabindex="0">\n        <div class="${s.NS}-inner">\n          <div class="${s.NS}-header">\n            <div class="${s.NS}-toolbar ${s.NS}-toolbar-header">\n            ${this._createBtns(this.options.headerToolbar)}\n            </div>\n            ${this._createTitle()}\n          </div>\n          <div class="${s.NS}-stage">\n            <img class="${s.NS}-image" src="" alt="" />\n          </div>\n          <div class="${s.NS}-footer">\n            <div class="${s.NS}-toolbar ${s.NS}-toolbar-footer">\n            ${this._createBtns(this.options.footerToolbar)}\n            </div>\n          </div>\n        </div>\n      </div>`}build(){const o=this._createTemplate(),e=i(o);this.$photoviewer=e,this.$stage=e.find(s.CLASS_NS+"-stage"),this.$title=e.find(s.CLASS_NS+"-title"),this.$image=e.find(s.CLASS_NS+"-image"),this.$close=e.find(s.CLASS_NS+"-button-close"),this.$maximize=e.find(s.CLASS_NS+"-button-maximize"),this.$minimize=e.find(s.CLASS_NS+"-button-minimize"),this.$zoomIn=e.find(s.CLASS_NS+"-button-zoomIn"),this.$zoomOut=e.find(s.CLASS_NS+"-button-zoomOut"),this.$actualSize=e.find(s.CLASS_NS+"-button-actualSize"),this.$fullscreen=e.find(s.CLASS_NS+"-button-fullscreen"),this.$rotateLeft=e.find(s.CLASS_NS+"-button-rotateLeft"),this.$rotateRight=e.find(s.CLASS_NS+"-button-rotateRight"),this.$prev=e.find(s.CLASS_NS+"-button-prev"),this.$next=e.find(s.CLASS_NS+"-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$photoviewer.css("z-index",s.PUBLIC_VARS.zIndex),this.options.dragHandle&&this.options.dragHandle!==s.CLASS_NS+"-modal"?this.dragHandle=this.$photoviewer.find(this.options.dragHandle):this.dragHandle=this.$photoviewer,i(this.options.appendTo).eq(0).append(this.$photoviewer),this._window=new h(this.$photoviewer[0],{dragHandle:this.options.dragHandle}),this._imager=new t(this.$stage[0],{ratioThreshold:this.options.ratioThreshold,minRatio:this.options.minRatio,maxRatio:this.options.maxRatio,movable:!0,classes:{grab:"is-grab",loader:"${ Constants.NS }-loader"}}),this._addEvents(),this._addCustomButtonEvents(),this.$photoviewer.on("resized",()=>{this._imager.resize()})}open(){if(this._triggerHook("beforeOpen",this),this.options.multiInstances||i(s.CLASS_NS+"-modal").eq(0).remove(),!i(s.CLASS_NS+"-modal").length&&this.options.fixedContent&&(i("html").css({overflow:"hidden"}),e.hasScrollbar())){const t=e.getScrollbarWidth();t&&i("html").css({"padding-right":t})}this.build(),this.setModalPos(this.$photoviewer),this.$photoviewer.get(0).focus(),this._triggerHook("opened",this)}close(){this._window.close()}setModalPos(t){const i=s.$W.width(),o=s.$W.height(),e=s.$D.scrollLeft(),h=s.$D.scrollTop(),a=this.options.modalWidth,n=this.options.modalHeight;this.options.initMaximized?(t.addClass(s.NS+"-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:a,height:n,left:(i-a)/2+e+"px",top:(o-n)/2+h+"px"})}setModalSize(t){const i=s.$W.width(),o=s.$W.height(),e=s.$D.scrollLeft(),h=s.$D.scrollTop(),a={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},n=t.width+parseFloat(a.left)+parseFloat(a.right)+parseFloat(a.borderLeft)+parseFloat(a.borderRight),r=t.height+parseFloat(a.top)+parseFloat(a.bottom)+parseFloat(a.borderTop)+parseFloat(a.borderBottom),d=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,l=Math.min(i/(n*d),o/(r*d),1);let p=Math.max(n*l,this.options.modalWidth),g=Math.max(r*l,this.options.modalHeight);const m={width:(p=this.options.fixedModalSize?this.options.modalWidth:Math.round(p))+"px",height:(g=this.options.fixedModalSize?this.options.modalHeight:Math.round(g))+"px",left:(i-p)/2+e+"px",top:(o-g)/2+h+"px"};this.options.initAnimation?this.$photoviewer.animate(m,400,"ease-in-out",()=>{this.setImageSize(t)}):(this.$photoviewer.css(m),this.setImageSize(t)),this.isOpened=!0}setImageSize(t){this._imager.setImageSize(t)}loadImage(t,i,o){this._imager.loadImage(t,t=>{this.setModalSize(t),i&&i.call()},o),this.options.title&&this.setImageTitle(t)}setImageTitle(t){const i=this.groupData[this.groupIndex].title||e.getImageNameFromUrl(t);this.$title.html(i)}jump(t){this._triggerHook("beforeChange",[this,this.groupIndex]),this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)}jumpTo(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImage(this.groupData[t].src,()=>{this._triggerHook("changed",[this,t])},()=>{this._triggerHook("changed",[this,t])})}zoom(t,i,o){this._imager.zoom(t,i,o)}zoomTo(t,i,o){this._imager.zoomTo(t,i,o)}rotate(t){this._imager.rotate(t)}rotateTo(t){this._imager.rotateTo(t)}resize(){return this._imager.resize()}maximize(){this._window.maximize()}fullscreen(){this._window.fullscreen()}_keydown(t){if(!this.options.keyboard)return!1;const i=t.keyCode||t.which||t.charCode;t.ctrlKey||t.metaKey,t.altKey||t.metaKey;switch(i){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 81:this.close()}}_addEvents(){this.$zoomIn.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$zoomOut.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$actualSize.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$prev.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.jump(-1)}),this.$next.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.jump(1)}),this.$rotateLeft.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.rotate(-90)}),this.$rotateRight.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.rotate(90)}),this.$photoviewer.off(s.KEYDOWN_EVENT+s.EVENT_NS).on(s.KEYDOWN_EVENT+s.EVENT_NS,t=>{this._keydown(t)})}_addCustomButtonEvents(){for(const t in this.options.customButtons)this.$photoviewer.find(s.CLASS_NS+"-button-"+t).off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,i=>{this.options.customButtons[t].click.apply(this,[this,i])})}_triggerHook(t,o){this.options.callbacks[t]&&this.options.callbacks[t].apply(this,i.isArray(o)?o:[o])}}return window.PhotoViewer=a,a});
//# sourceMappingURL=sourcemaps/core.js.map
