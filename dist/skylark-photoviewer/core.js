/**
 * skylark-photoviewer - A version of dat.gui.js  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-photoviewer/
 * @license MIT
 */
define(["./domq","./defaults","./constants","./utilities","./window","./picture_viewer"],function(t,i,o,s,e,h){"use strict";class a{constructor(o,s,e){this.options=t.extend(!0,{},i,s),s&&t.isArray(s.footerToolbar)&&(this.options.footerToolbar=s.footerToolbar),s&&t.isArray(s.headerToolbar)&&(this.options.headerToolbar=s.headerToolbar),this.$el=t(e),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isDoResize=!1,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(o,this.options)}init(t,i){this.groupData=t,this.groupIndex=i.index,o.PUBLIC_VARS.zIndex=0===o.PUBLIC_VARS.zIndex?i.zIndex:o.PUBLIC_VARS.zIndex;const s=t[this.groupIndex].src;this.open(),this.loadImage(s)}_createBtns(i){const s=["minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight"];let e="";return t.each(i,(t,i)=>{const h=`${o.NS}-button ${o.NS}-button-${i}`;s.indexOf(i)>=0?e+=`<button class="${h}" title="${this.options.i18n[i]}">\n          ${this.options.icons[i]}\n          </button>`:this.options.customButtons[i]&&(e+=`<button class="${h}" title="${this.options.customButtons[i].title||""}">\n          ${this.options.customButtons[i].text}\n          </button>`)}),e}_createTitle(){return this.options.title?`<div class="${o.NS}-title"></div>`:""}_createTemplate(){return`<div class="${o.NS}-modal" tabindex="0">\n        <div class="${o.NS}-inner">\n          <div class="${o.NS}-header">\n            <div class="${o.NS}-toolbar ${o.NS}-toolbar-header">\n            ${this._createBtns(this.options.headerToolbar)}\n            </div>\n            ${this._createTitle()}\n          </div>\n          <div class="${o.NS}-stage">\n            <img class="${o.NS}-image" src="" alt="" />\n          </div>\n          <div class="${o.NS}-footer">\n            <div class="${o.NS}-toolbar ${o.NS}-toolbar-footer">\n            ${this._createBtns(this.options.footerToolbar)}\n            </div>\n          </div>\n        </div>\n      </div>`}build(){const i=this._createTemplate(),s=t(i);this.$photoviewer=s,this.$stage=s.find(o.CLASS_NS+"-stage"),this.$title=s.find(o.CLASS_NS+"-title"),this.$image=s.find(o.CLASS_NS+"-image"),this.$close=s.find(o.CLASS_NS+"-button-close"),this.$maximize=s.find(o.CLASS_NS+"-button-maximize"),this.$minimize=s.find(o.CLASS_NS+"-button-minimize"),this.$zoomIn=s.find(o.CLASS_NS+"-button-zoomIn"),this.$zoomOut=s.find(o.CLASS_NS+"-button-zoomOut"),this.$actualSize=s.find(o.CLASS_NS+"-button-actualSize"),this.$fullscreen=s.find(o.CLASS_NS+"-button-fullscreen"),this.$rotateLeft=s.find(o.CLASS_NS+"-button-rotateLeft"),this.$rotateRight=s.find(o.CLASS_NS+"-button-rotateRight"),this.$prev=s.find(o.CLASS_NS+"-button-prev"),this.$next=s.find(o.CLASS_NS+"-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$photoviewer.css("z-index",o.PUBLIC_VARS.zIndex),this.options.dragHandle&&this.options.dragHandle!==o.CLASS_NS+"-modal"?this.dragHandle=this.$photoviewer.find(this.options.dragHandle):this.dragHandle=this.$photoviewer,t(this.options.appendTo).eq(0).append(this.$photoviewer),this._window=new e(this.$photoviewer[0],{dragHandle:this.options.dragHandle}),this._imager=new h(this.$stage[0]),this._addEvents(),this._addCustomButtonEvents(),this.$photoviewer.on("resized",()=>{this._imager.resize()})}open(){if(this._triggerHook("beforeOpen",this),this.options.multiInstances||t(o.CLASS_NS+"-modal").eq(0).remove(),!t(o.CLASS_NS+"-modal").length&&this.options.fixedContent&&(t("html").css({overflow:"hidden"}),s.hasScrollbar())){const i=s.getScrollbarWidth();i&&t("html").css({"padding-right":i})}this.build(),this.setModalPos(this.$photoviewer),this.$photoviewer.get(0).focus(),this._triggerHook("opened",this)}close(){this._window.close()}setModalPos(t){const i=o.$W.width(),s=o.$W.height(),e=o.$D.scrollLeft(),h=o.$D.scrollTop(),a=this.options.modalWidth,n=this.options.modalHeight;this.options.initMaximized?(t.addClass(o.NS+"-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:a,height:n,left:(i-a)/2+e+"px",top:(s-n)/2+h+"px"})}setModalSize(t){const i=o.$W.width(),s=o.$W.height(),e=o.$D.scrollLeft(),h=o.$D.scrollTop(),a={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},n=t.width+parseFloat(a.left)+parseFloat(a.right)+parseFloat(a.borderLeft)+parseFloat(a.borderRight),r=t.height+parseFloat(a.top)+parseFloat(a.bottom)+parseFloat(a.borderTop)+parseFloat(a.borderBottom),d=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,l=Math.min(i/(n*d),s/(r*d),1);let p=Math.max(n*l,this.options.modalWidth),g=Math.max(r*l,this.options.modalHeight);const m={width:(p=this.options.fixedModalSize?this.options.modalWidth:Math.round(p))+"px",height:(g=this.options.fixedModalSize?this.options.modalHeight:Math.round(g))+"px",left:(i-p)/2+e+"px",top:(s-g)/2+h+"px"};this.options.initAnimation?this.$photoviewer.animate(m,400,"ease-in-out",()=>{this.setImageSize(t)}):(this.$photoviewer.css(m),this.setImageSize(t)),this.isOpened=!0}setImageSize(t){this._imager.setImageSize(t)}loadImage(t,i,o){this._imager.loadImage(t,t=>{this.setModalSize(t),i&&i.call()},o),this.options.title&&this.setImageTitle(t)}setImageTitle(t){const i=this.groupData[this.groupIndex].title||s.getImageNameFromUrl(t);this.$title.html(i)}jump(t){this._triggerHook("beforeChange",[this,this.groupIndex]),this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)}jumpTo(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImage(this.groupData[t].src,()=>{this._triggerHook("changed",[this,t])},()=>{this._triggerHook("changed",[this,t])})}zoom(t,i,o){this._imager.zoom(t,i,o)}zoomTo(t,i,o){this._imager.zoomTo(t,i,o)}rotate(t){this._imager.rotate(t)}rotateTo(t){this._imager.rotateTo(t)}resize(){return this._imager.resize()}maximize(){this._window.maximize()}fullscreen(){this._window.fullscreen()}_keydown(t){if(!this.options.keyboard)return!1;const i=t.keyCode||t.which||t.charCode;t.ctrlKey||t.metaKey,t.altKey||t.metaKey;switch(i){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 81:this.close()}}_addEvents(){this.$zoomIn.off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,t=>{this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$zoomOut.off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,t=>{this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$actualSize.off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,t=>{this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$prev.off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,()=>{this.jump(-1)}),this.$next.off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,()=>{this.jump(1)}),this.$rotateLeft.off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,()=>{this.rotate(-90)}),this.$rotateRight.off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,()=>{this.rotate(90)}),this.$photoviewer.off(o.KEYDOWN_EVENT+o.EVENT_NS).on(o.KEYDOWN_EVENT+o.EVENT_NS,t=>{this._keydown(t)})}_addCustomButtonEvents(){for(const t in this.options.customButtons)this.$photoviewer.find(o.CLASS_NS+"-button-"+t).off(o.CLICK_EVENT+o.EVENT_NS).on(o.CLICK_EVENT+o.EVENT_NS,i=>{this.options.customButtons[t].click.apply(this,[this,i])})}_triggerHook(i,o){this.options.callbacks[i]&&this.options.callbacks[i].apply(this,t.isArray(o)?o:[o])}}return window.PhotoViewer=a,a});
//# sourceMappingURL=sourcemaps/core.js.map
