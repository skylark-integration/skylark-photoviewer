{"version":3,"sources":["core.js"],"names":["define","Imager","$","DEFAULTS","Constants","Utilities","Window","PhotoViewer","[object Object]","items","options","el","this","extend","isArray","footerToolbar","headerToolbar","$el","isOpened","isMaximized","isRotated","rotateAngle","isDoResize","imageData","modalData","width","height","left","top","init","opts","groupData","groupIndex","PUBLIC_VARS","imgSrc","open","loadImage","toolbar","btns","btnsHTML","each","index","item","btnClass","NS","indexOf","i18n","icons","customButtons","title","text","_createBtns","_createTitle","photoviewerHTML","_createTemplate","$photoviewer","$stage","find","CLASS_NS","$title","$image","$close","$maximize","$minimize","$zoomIn","$zoomOut","$actualSize","$fullscreen","$rotateLeft","$rotateRight","$prev","$next","addClass","css","dragHandle","appendTo","eq","append","_window","_imager","ratioThreshold","minRatio","maxRatio","movable","classes","grab","loader","_addEvents","_addCustomButtonEvents","on","resize","_triggerHook","multiInstances","remove","length","fixedContent","overflow","hasScrollbar","scrollbarWidth","getScrollbarWidth","padding-right","build","setModalPos","get","focus","close","modal","winWidth","$W","winHeight","scrollLeft","$D","scrollTop","modalWidth","modalHeight","initMaximized","img","stageCSS","right","bottom","borderLeft","borderRight","borderTop","borderBottom","parseFloat","gapThreshold","scale","Math","min","minWidth","max","minHeight","modalCSSObj","fixedModalSize","round","initAnimation","animate","setImageSize","fn","err","setModalSize","call","setImageTitle","url","getImageNameFromUrl","html","step","jumpTo","src","ratio","origin","e","zoom","zoomTo","angle","rotate","rotateTo","maximize","fullscreen","keyboard","keyCode","which","charCode","ctrlKey","metaKey","altKey","jump","off","CLICK_EVENT","EVENT_NS","x","y","KEYDOWN_EVENT","_keydown","btnKey","click","apply","data","callbacks","window"],"mappings":";;;;;;;AAAAA,QACI,uCACA,SACA,aACA,cACA,cACA,YACD,SAAUC,EAAOC,EAAGC,EAAUC,EAAWC,EAAWC,GACnD,mBAGMC,EACFC,YAAYC,EAAOC,EAASC,GACxBC,KAAKF,QAAUR,EAAEW,QAAO,KAAUV,EAAUO,GACxCA,GAAWR,EAAEY,QAAQJ,EAAQK,iBAC7BH,KAAKF,QAAQK,cAAgBL,EAAQK,eAErCL,GAAWR,EAAEY,QAAQJ,EAAQM,iBAC7BJ,KAAKF,QAAQM,cAAgBN,EAAQM,eAEzCJ,KAAKK,IAAMf,EAAES,GACbC,KAAKM,UAAW,EAChBN,KAAKO,aAAc,EACnBP,KAAKQ,WAAY,EACjBR,KAAKS,YAAc,EACnBT,KAAKU,YAAa,EAClBV,KAAKW,aACLX,KAAKY,WACDC,MAAO,KACPC,OAAQ,KACRC,KAAM,KACNC,IAAK,MAEThB,KAAKiB,KAAKpB,EAAOG,KAAKF,SAE1BF,KAAKC,EAAOqB,GACRlB,KAAKmB,UAAYtB,EACjBG,KAAKoB,WAAaF,EAAY,MAC9B1B,EAAU6B,YAAoB,OAAwC,IAApC7B,EAAU6B,YAAoB,OAAUH,EAAa,OAAI1B,EAAU6B,YAAoB,OACzH,MAAMC,EAASzB,EAAMG,KAAKoB,YAAiB,IAC3CpB,KAAKuB,OACLvB,KAAKwB,UAAUF,GAWnB1B,YAAY6B,GACR,MAAMC,GACF,WACA,WACA,QACA,SACA,UACA,OACA,OACA,aACA,aACA,aACA,eAEJ,IAAIC,EAAW,GAaf,OAZArC,EAAEsC,KAAKH,EAAS,CAACI,EAAOC,KACpB,MAAMC,KAAevC,EAAUwC,aAAexC,EAAUwC,aAAeF,IACnEJ,EAAKO,QAAQH,IAAS,EACtBH,qBAA+BI,aAAsB/B,KAAKF,QAAQoC,KAAKJ,mBAC9E9B,KAAKF,QAAQqC,MAAML,0BAEL9B,KAAKF,QAAQsC,cAAcN,KAClCH,qBAA+BI,aAAsB/B,KAAKF,QAAQsC,cAAcN,GAAMO,OAAS,mBACtGrC,KAAKF,QAAQsC,cAAcN,GAAMQ,+BAI3BX,EAEX/B,eACI,OAAOI,KAAKF,QAAQuC,qBAAwB7C,EAAUwC,mBAAsB,GAEhFpC,kBAmBI,qBAlBwCJ,EAAUwC,gDACvCxC,EAAUwC,qCACRxC,EAAUwC,wCACRxC,EAAUwC,cAAgBxC,EAAUwC,oCAChDhC,KAAKuC,YAAYvC,KAAKF,QAAQM,mDAE9BJ,KAAKwC,2DAEKhD,EAAUwC,uCACRxC,EAAUwC,uEAEZxC,EAAUwC,wCACRxC,EAAUwC,cAAgBxC,EAAUwC,oCAChDhC,KAAKuC,YAAYvC,KAAKF,QAAQK,qFAOrCP,QACI,MAAM6C,EAAkBzC,KAAK0C,kBACvBC,EAAerD,EAAEmD,GACvBzC,KAAK2C,aAAeA,EACpB3C,KAAK4C,OAASD,EAAaE,KAAKrD,EAAUsD,SAAW,UACrD9C,KAAK+C,OAASJ,EAAaE,KAAKrD,EAAUsD,SAAW,UACrD9C,KAAKgD,OAASL,EAAaE,KAAKrD,EAAUsD,SAAW,UACrD9C,KAAKiD,OAASN,EAAaE,KAAKrD,EAAUsD,SAAW,iBACrD9C,KAAKkD,UAAYP,EAAaE,KAAKrD,EAAUsD,SAAW,oBACxD9C,KAAKmD,UAAYR,EAAaE,KAAKrD,EAAUsD,SAAW,oBACxD9C,KAAKoD,QAAUT,EAAaE,KAAKrD,EAAUsD,SAAW,kBACtD9C,KAAKqD,SAAWV,EAAaE,KAAKrD,EAAUsD,SAAW,mBACvD9C,KAAKsD,YAAcX,EAAaE,KAAKrD,EAAUsD,SAAW,sBAC1D9C,KAAKuD,YAAcZ,EAAaE,KAAKrD,EAAUsD,SAAW,sBAC1D9C,KAAKwD,YAAcb,EAAaE,KAAKrD,EAAUsD,SAAW,sBAC1D9C,KAAKyD,aAAed,EAAaE,KAAKrD,EAAUsD,SAAW,uBAC3D9C,KAAK0D,MAAQf,EAAaE,KAAKrD,EAAUsD,SAAW,gBACpD9C,KAAK2D,MAAQhB,EAAaE,KAAKrD,EAAUsD,SAAW,gBACpD9C,KAAK4C,OAAOgB,SAAS,eACrB5D,KAAKgD,OAAOY,SAAS,eACrB5D,KAAK2C,aAAakB,IAAI,UAAWrE,EAAU6B,YAAoB,QAC1DrB,KAAKF,QAAQgE,YAAc9D,KAAKF,QAAQgE,aAAetE,EAAUsD,SAAW,SAG7E9C,KAAK8D,WAAa9D,KAAK2C,aAAaE,KAAK7C,KAAKF,QAAQgE,YAFtD9D,KAAK8D,WAAa9D,KAAK2C,aAI3BrD,EAAEU,KAAKF,QAAQiE,UAAUC,GAAG,GAAGC,OAAOjE,KAAK2C,cAE3C3C,KAAKkE,QAAU,IAAIxE,EAAOM,KAAK2C,aAAa,IACxCmB,WAAa9D,KAAKF,QAAQgE,aAG9B9D,KAAKmE,QAAU,IAAI9E,EAAOW,KAAK4C,OAAO,IAClCwB,eAAgBpE,KAAKF,QAAQsE,eAC7BC,SAAUrE,KAAKF,QAAQuE,SACvBC,SAAUtE,KAAKF,QAAQwE,SACvBC,SAAU,EAEVC,SACIC,KAAO,UACPC,OAAS,8BAIjB1E,KAAK2E,aACL3E,KAAK4E,yBAEL5E,KAAK2C,aAAakC,GAAG,UAAU,KAC3B7E,KAAKmE,QAAQW,WAGrBlF,OAKI,GAJAI,KAAK+E,aAAa,aAAc/E,MAC3BA,KAAKF,QAAQkF,gBACd1F,EAAEE,EAAUsD,SAAW,UAAUkB,GAAG,GAAGiB,UAEtC3F,EAAEE,EAAUsD,SAAW,UAAUoC,QAAUlF,KAAKF,QAAQqF,eACzD7F,EAAE,QAAQuE,KAAMuB,SAAU,WACtB3F,EAAU4F,gBAAgB,CAC1B,MAAMC,EAAiB7F,EAAU8F,oBAC7BD,GACAhG,EAAE,QAAQuE,KAAM2B,gBAAiBF,IAI7CtF,KAAKyF,QACLzF,KAAK0F,YAAY1F,KAAK2C,cACtB3C,KAAK2C,aAAagD,IAAI,GAAGC,QACzB5F,KAAK+E,aAAa,SAAU/E,MAEhCJ,QACII,KAAKkE,QAAQ2B,QAEjBjG,YAAYkG,GACR,MAAMC,EAAWvG,EAAUwG,GAAGnF,QACxBoF,EAAYzG,EAAUwG,GAAGlF,SACzBoF,EAAa1G,EAAU2G,GAAGD,aAC1BE,EAAY5G,EAAU2G,GAAGC,YACzBC,EAAarG,KAAKF,QAAQuG,WAC1BC,EAActG,KAAKF,QAAQwG,YAC7BtG,KAAKF,QAAQyG,eACbT,EAAMlC,SAASpE,EAAUwC,GAAK,aAC9B8D,EAAMjC,KACFhD,MAAO,OACPC,OAAQ,OACRC,KAAM,EACNC,IAAK,IAEThB,KAAKM,UAAW,EAChBN,KAAKO,aAAc,GAEnBuF,EAAMjC,KACFhD,MAAOwF,EACPvF,OAAQwF,EACRvF,MAAOgF,EAAWM,GAAc,EAAIH,EAAa,KACjDlF,KAAMiF,EAAYK,GAAe,EAAIF,EAAY,OAI7DxG,aAAa4G,GACT,MAAMT,EAAWvG,EAAUwG,GAAGnF,QACxBoF,EAAYzG,EAAUwG,GAAGlF,SACzBoF,EAAa1G,EAAU2G,GAAGD,aAC1BE,EAAY5G,EAAU2G,GAAGC,YACzBK,GACF1F,KAAMf,KAAK4C,OAAOiB,IAAI,QACtB6C,MAAO1G,KAAK4C,OAAOiB,IAAI,SACvB7C,IAAKhB,KAAK4C,OAAOiB,IAAI,OACrB8C,OAAQ3G,KAAK4C,OAAOiB,IAAI,UACxB+C,WAAY5G,KAAK4C,OAAOiB,IAAI,qBAC5BgD,YAAa7G,KAAK4C,OAAOiB,IAAI,sBAC7BiD,UAAW9G,KAAK4C,OAAOiB,IAAI,oBAC3BkD,aAAc/G,KAAK4C,OAAOiB,IAAI,wBAE5BwC,EAAaG,EAAI3F,MAAQmG,WAAWP,EAAS1F,MAAQiG,WAAWP,EAASC,OAASM,WAAWP,EAASG,YAAcI,WAAWP,EAASI,aACxIP,EAAcE,EAAI1F,OAASkG,WAAWP,EAASzF,KAAOgG,WAAWP,EAASE,QAAUK,WAAWP,EAASK,WAAaE,WAAWP,EAASM,cACzIE,GAAgBjH,KAAKF,QAAQmH,aAAe,EAAIjH,KAAKF,QAAQmH,aAAe,GAAK,EACjFC,EAAQC,KAAKC,IAAIrB,GAAYM,EAAaY,GAAehB,GAAaK,EAAcW,GAAe,GACzG,IAAII,EAAWF,KAAKG,IAAIjB,EAAaa,EAAOlH,KAAKF,QAAQuG,YACrDkB,EAAYJ,KAAKG,IAAIhB,EAAcY,EAAOlH,KAAKF,QAAQwG,aAG3D,MAAMkB,GACF3G,OAHJwG,EAAWrH,KAAKF,QAAQ2H,eAAiBzH,KAAKF,QAAQuG,WAAac,KAAKO,MAAML,IAGxD,KAClBvG,QAHJyG,EAAYvH,KAAKF,QAAQ2H,eAAiBzH,KAAKF,QAAQwG,YAAca,KAAKO,MAAMH,IAGxD,KACpBxG,MAAOgF,EAAWsB,GAAY,EAAInB,EAAa,KAC/ClF,KAAMiF,EAAYsB,GAAa,EAAInB,EAAY,MAE/CpG,KAAKF,QAAQ6H,cACb3H,KAAK2C,aAAaiF,QAAQJ,EAAa,IAAK,cAAe,KACvDxH,KAAK6H,aAAarB,MAGtBxG,KAAK2C,aAAakB,IAAI2D,GACtBxH,KAAK6H,aAAarB,IAEtBxG,KAAKM,UAAW,EAGpBV,aAAa4G,GACTxG,KAAKmE,QAAQ0D,aAAarB,GAE9B5G,UAAU0B,EAAQwG,EAAIC,GAClB/H,KAAKmE,QAAQ3C,UAAUF,EAAQkF,IAC3BxG,KAAKgI,aAAaxB,GACdsB,GACAA,EAAGG,QAETF,GACE/H,KAAKF,QAAQuC,OACbrC,KAAKkI,cAAc5G,GAG3B1B,cAAcuI,GACV,MAAM9F,EAAQrC,KAAKmB,UAAUnB,KAAKoB,YAAYiB,OAAS5C,EAAU2I,oBAAoBD,GACrFnI,KAAK+C,OAAOsF,KAAKhG,GAErBzC,KAAK0I,GACDtI,KAAK+E,aAAa,gBACd/E,KACAA,KAAKoB,aAETpB,KAAKoB,WAAapB,KAAKoB,WAAakH,EACpCtI,KAAKuI,OAAOvI,KAAKoB,YAErBxB,OAAOiC,IACHA,GAAgB7B,KAAKmB,UAAU+D,SAClB,EACTrD,GAAgB7B,KAAKmB,UAAU+D,OACxBrD,EAAQ,IACfA,GAAS7B,KAAKmB,UAAU+D,OAASrD,GAAS7B,KAAKmB,UAAU+D,QAE7DlF,KAAKoB,WAAaS,EAClB7B,KAAKwB,UAAUxB,KAAKmB,UAAUU,GAAO2G,IAAK,KACtCxI,KAAK+E,aAAa,WACd/E,KACA6B,KAEL,KACC7B,KAAK+E,aAAa,WACd/E,KACA6B,MAIZjC,KAAK6I,EAAOC,EAAQC,GAChB3I,KAAKmE,QAAQyE,KAAKH,EAAMC,EAAOC,GAEnC/I,OAAO6I,EAAOC,EAAQC,GAClB3I,KAAKmE,QAAQ0E,OAAOJ,EAAMC,EAAOC,GAErC/I,OAAOkJ,GACH9I,KAAKmE,QAAQ4E,OAAOD,GAExBlJ,SAASkJ,GACL9I,KAAKmE,QAAQ6E,SAASF,GAE1BlJ,SACI,OAAOI,KAAKmE,QAAQW,SAExBlF,WACII,KAAKkE,QAAQ+E,WAEjBrJ,aACII,KAAKkE,QAAQgF,aAEjBtJ,SAAS+I,GACL,IAAK3I,KAAKF,QAAQqJ,SACd,OAAO,EAEX,MAAMC,EAAUT,EAAES,SAAWT,EAAEU,OAASV,EAAEW,SAC1BX,EAAEY,SAAWZ,EAAEa,QAChBb,EAAEc,QAAUd,EAAEa,QAC7B,OAAQJ,GAEJ,KAAK,GACDpJ,KAAK0J,MAAM,GACX,MAEJ,KAAK,GACD1J,KAAK0J,KAAK,GACV,MAEJ,KAAK,GACD1J,KAAK6F,SAKjBjG,aAEII,KAAKoD,QAAQuG,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAUlB,IACxG3I,KAAK4I,KAAmC,EAA9B5I,KAAKF,QAAQsE,gBACnB0F,EAAG9J,KAAK4C,OAAO/B,QAAU,EACzBkJ,EAAG/J,KAAK4C,OAAO9B,SAAW,GAC3B6H,KAEP3I,KAAKqD,SAASsG,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAUlB,IACzG3I,KAAK4I,KAAoC,GAA9B5I,KAAKF,QAAQsE,gBACpB0F,EAAG9J,KAAK4C,OAAO/B,QAAU,EACzBkJ,EAAG/J,KAAK4C,OAAO9B,SAAW,GAC3B6H,KAEP3I,KAAKsD,YAAYqG,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAUlB,IAC5G3I,KAAK6I,OAAO,GACRiB,EAAG9J,KAAK4C,OAAO/B,QAAU,EACzBkJ,EAAG/J,KAAK4C,OAAO9B,SAAW,GAC3B6H,KAEP3I,KAAK0D,MAAMiG,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAU,KACtG7J,KAAK0J,MAAM,KAGf1J,KAAK2D,MAAMgG,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAU,KACtG7J,KAAK0J,KAAK,KAEd1J,KAAKwD,YAAYmG,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAU,KAC5G7J,KAAK+I,QAAQ,MAEjB/I,KAAKyD,aAAakG,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAU,KAC7G7J,KAAK+I,OAAO,MAGhB/I,KAAK2C,aAAagH,IAAInK,EAAUwK,cAAgBxK,EAAUqK,UAAUhF,GAAGrF,EAAUwK,cAAgBxK,EAAUqK,SAAUlB,IACjH3I,KAAKiK,SAAStB,KAItB/I,yBACI,IAAK,MAAMsK,KAAUlK,KAAKF,QAAQsC,cAC9BpC,KAAK2C,aAAaE,KAAKrD,EAAUsD,SAAW,WAAaoH,GAAQP,IAAInK,EAAUoK,YAAcpK,EAAUqK,UAAUhF,GAAGrF,EAAUoK,YAAcpK,EAAUqK,SAAUlB,IAC5J3I,KAAKF,QAAQsC,cAAc8H,GAAQC,MAAMC,MAAMpK,MAC3CA,KACA2I,MAKhB/I,aAAa+I,EAAG0B,GACRrK,KAAKF,QAAQwK,UAAU3B,IACvB3I,KAAKF,QAAQwK,UAAU3B,GAAGyB,MAAMpK,KAAMV,EAAEY,QAAQmK,GAAQA,GAAQA,KAS5E,OADAE,OAAO5K,YAAcA,EACdA","file":"../core.js","sourcesContent":["define([\n    \"skylark-domx-plugins-pictures/viewer\",\n    './domq',\n    './defaults',\n    './constants',\n    './utilities',\n    \"./window\",\n], function (Imager,$, DEFAULTS, Constants, Utilities, Window) {\n    'use strict';\n\n    \n    class PhotoViewer {\n        constructor(items, options, el) {\n            this.options = $.extend(true, {}, DEFAULTS, options);\n            if (options && $.isArray(options.footerToolbar)) {\n                this.options.footerToolbar = options.footerToolbar;\n            }\n            if (options && $.isArray(options.headerToolbar)) {\n                this.options.headerToolbar = options.headerToolbar;\n            }\n            this.$el = $(el);\n            this.isOpened = false;\n            this.isMaximized = false;\n            this.isRotated = false;\n            this.rotateAngle = 0;\n            this.isDoResize = false;\n            this.imageData = {};\n            this.modalData = {\n                width: null,\n                height: null,\n                left: null,\n                top: null\n            };\n            this.init(items, this.options);\n        }\n        init(items, opts) {\n            this.groupData = items;\n            this.groupIndex = opts['index'];\n            Constants.PUBLIC_VARS['zIndex'] = Constants.PUBLIC_VARS['zIndex'] === 0 ? opts['zIndex'] : Constants.PUBLIC_VARS['zIndex'];\n            const imgSrc = items[this.groupIndex]['src'];\n            this.open();\n            this.loadImage(imgSrc);\n            ///if (opts.draggable) {\n            ///    this.draggable(this.$photoviewer, this.dragHandle, Constants.CLASS_NS + '-button');\n            ///}\n            ///if (opts.movable) {\n            ///    this.movable(this.$stage, this.$image);\n            ///}\n            ///if (opts.resizable) {\n            ///    this.resizable(this.$photoviewer, this.$stage, this.$image, opts.modalWidth, opts.modalHeight);\n            ///}\n        }\n        _createBtns(toolbar) {\n            const btns = [\n                'minimize',\n                'maximize',\n                'close',\n                'zoomIn',\n                'zoomOut',\n                'prev',\n                'next',\n                'fullscreen',\n                'actualSize',\n                'rotateLeft',\n                'rotateRight'\n            ];\n            let btnsHTML = '';\n            $.each(toolbar, (index, item) => {\n                const btnClass = `${ Constants.NS }-button ${ Constants.NS }-button-${ item }`;\n                if (btns.indexOf(item) >= 0) {\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.i18n[item] }\">\n          ${ this.options.icons[item] }\n          </button>`;\n                } else if (this.options.customButtons[item]) {\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.customButtons[item].title || '' }\">\n          ${ this.options.customButtons[item].text }\n          </button>`;\n                }\n            });\n            return btnsHTML;\n        }\n        _createTitle() {\n            return this.options.title ? `<div class=\"${ Constants.NS }-title\"></div>` : '';\n        }\n        _createTemplate() {\n            const photoviewerHTML = `<div class=\"${ Constants.NS }-modal\" tabindex=\"0\">\n        <div class=\"${ Constants.NS }-inner\">\n          <div class=\"${ Constants.NS }-header\">\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-header\">\n            ${ this._createBtns(this.options.headerToolbar) }\n            </div>\n            ${ this._createTitle() }\n          </div>\n          <div class=\"${ Constants.NS }-stage\">\n            <img class=\"${ Constants.NS }-image\" src=\"\" alt=\"\" />\n          </div>\n          <div class=\"${ Constants.NS }-footer\">\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-footer\">\n            ${ this._createBtns(this.options.footerToolbar) }\n            </div>\n          </div>\n        </div>\n      </div>`;\n            return photoviewerHTML;\n        }\n        build() {\n            const photoviewerHTML = this._createTemplate();\n            const $photoviewer = $(photoviewerHTML);\n            this.$photoviewer = $photoviewer;\n            this.$stage = $photoviewer.find(Constants.CLASS_NS + '-stage');\n            this.$title = $photoviewer.find(Constants.CLASS_NS + '-title');\n            this.$image = $photoviewer.find(Constants.CLASS_NS + '-image');\n            this.$close = $photoviewer.find(Constants.CLASS_NS + '-button-close');\n            this.$maximize = $photoviewer.find(Constants.CLASS_NS + '-button-maximize');\n            this.$minimize = $photoviewer.find(Constants.CLASS_NS + '-button-minimize');\n            this.$zoomIn = $photoviewer.find(Constants.CLASS_NS + '-button-zoomIn');\n            this.$zoomOut = $photoviewer.find(Constants.CLASS_NS + '-button-zoomOut');\n            this.$actualSize = $photoviewer.find(Constants.CLASS_NS + '-button-actualSize');\n            this.$fullscreen = $photoviewer.find(Constants.CLASS_NS + '-button-fullscreen');\n            this.$rotateLeft = $photoviewer.find(Constants.CLASS_NS + '-button-rotateLeft');\n            this.$rotateRight = $photoviewer.find(Constants.CLASS_NS + '-button-rotateRight');\n            this.$prev = $photoviewer.find(Constants.CLASS_NS + '-button-prev');\n            this.$next = $photoviewer.find(Constants.CLASS_NS + '-button-next');\n            this.$stage.addClass('stage-ready');\n            this.$image.addClass('image-ready');\n            this.$photoviewer.css('z-index', Constants.PUBLIC_VARS['zIndex']);\n            if (!this.options.dragHandle || this.options.dragHandle === Constants.CLASS_NS + '-modal') {\n                this.dragHandle = this.$photoviewer;\n            } else {\n                this.dragHandle = this.$photoviewer.find(this.options.dragHandle);\n            }\n            $(this.options.appendTo).eq(0).append(this.$photoviewer);\n\n            this._window = new Window(this.$photoviewer[0],{\n                dragHandle : this.options.dragHandle,\n\n            });\n            this._imager = new Imager(this.$stage[0],{\n                ratioThreshold: this.options.ratioThreshold,\n                minRatio: this.options.minRatio,\n                maxRatio: this.options.maxRatio,\n                movable : true,\n\n                classes : {\n                    grab : \"is-grab\",\n                    loader : \"${ Constants.NS }-loader\"\n                }                \n            });\n\n            this._addEvents();\n            this._addCustomButtonEvents();\n\n            this.$photoviewer.on(\"resized\",()=>{\n                this._imager.resize();;\n            });\n        }\n        open() {\n            this._triggerHook('beforeOpen', this);\n            if (!this.options.multiInstances) {\n                $(Constants.CLASS_NS + '-modal').eq(0).remove();\n            }\n            if (!$(Constants.CLASS_NS + '-modal').length && this.options.fixedContent) {\n                $('html').css({ overflow: 'hidden' });\n                if (Utilities.hasScrollbar()) {\n                    const scrollbarWidth = Utilities.getScrollbarWidth();\n                    if (scrollbarWidth) {\n                        $('html').css({ 'padding-right': scrollbarWidth });\n                    }\n                }\n            }\n            this.build();\n            this.setModalPos(this.$photoviewer);\n            this.$photoviewer.get(0).focus();\n            this._triggerHook('opened', this);\n        }\n        close() {\n            this._window.close();\n        }\n        setModalPos(modal) {\n            const winWidth = Constants.$W.width();\n            const winHeight = Constants.$W.height();\n            const scrollLeft = Constants.$D.scrollLeft();\n            const scrollTop = Constants.$D.scrollTop();\n            const modalWidth = this.options.modalWidth;\n            const modalHeight = this.options.modalHeight;\n            if (this.options.initMaximized) {\n                modal.addClass(Constants.NS + '-maximize');\n                modal.css({\n                    width: '100%',\n                    height: '100%',\n                    left: 0,\n                    top: 0\n                });\n                this.isOpened = true;\n                this.isMaximized = true;\n            } else {\n                modal.css({\n                    width: modalWidth,\n                    height: modalHeight,\n                    left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\n                    top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\n                });\n            }\n        }\n        setModalSize(img) {\n            const winWidth = Constants.$W.width();\n            const winHeight = Constants.$W.height();\n            const scrollLeft = Constants.$D.scrollLeft();\n            const scrollTop = Constants.$D.scrollTop();\n            const stageCSS = {\n                left: this.$stage.css('left'),\n                right: this.$stage.css('right'),\n                top: this.$stage.css('top'),\n                bottom: this.$stage.css('bottom'),\n                borderLeft: this.$stage.css('border-left-width'),\n                borderRight: this.$stage.css('border-right-width'),\n                borderTop: this.$stage.css('border-top-width'),\n                borderBottom: this.$stage.css('border-bottom-width')\n            };\n            const modalWidth = img.width + parseFloat(stageCSS.left) + parseFloat(stageCSS.right) + parseFloat(stageCSS.borderLeft) + parseFloat(stageCSS.borderRight);\n            const modalHeight = img.height + parseFloat(stageCSS.top) + parseFloat(stageCSS.bottom) + parseFloat(stageCSS.borderTop) + parseFloat(stageCSS.borderBottom);\n            const gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1;\n            const scale = Math.min(winWidth / (modalWidth * gapThreshold), winHeight / (modalHeight * gapThreshold), 1);\n            let minWidth = Math.max(modalWidth * scale, this.options.modalWidth);\n            let minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\n            minWidth = this.options.fixedModalSize ? this.options.modalWidth : Math.round(minWidth);\n            minHeight = this.options.fixedModalSize ? this.options.modalHeight : Math.round(minHeight);\n            const modalCSSObj = {\n                width: minWidth + 'px',\n                height: minHeight + 'px',\n                left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\n                top: (winHeight - minHeight) / 2 + scrollTop + 'px'\n            };\n            if (this.options.initAnimation) {\n                this.$photoviewer.animate(modalCSSObj, 400, 'ease-in-out', () => {\n                    this.setImageSize(img);\n                });\n            } else {\n                this.$photoviewer.css(modalCSSObj);\n                this.setImageSize(img);\n            }\n            this.isOpened = true;\n        }\n\n        setImageSize(img) {\n            this._imager.setImageSize(img);\n        }\n        loadImage(imgSrc, fn, err) {\n            this._imager.loadImage(imgSrc,(img) => {\n                this.setModalSize(img);\n                if (fn) {\n                    fn.call();\n                }\n            },err);\n            if (this.options.title) {\n                this.setImageTitle(imgSrc);\n            }\n        }\n        setImageTitle(url) {\n            const title = this.groupData[this.groupIndex].title || Utilities.getImageNameFromUrl(url);\n            this.$title.html(title);\n        }\n        jump(step) {\n            this._triggerHook('beforeChange', [\n                this,\n                this.groupIndex\n            ]);\n            this.groupIndex = this.groupIndex + step;\n            this.jumpTo(this.groupIndex);\n        }\n        jumpTo(index) {\n            index = index % this.groupData.length;\n            if (index >= 0) {\n                index = index % this.groupData.length;\n            } else if (index < 0) {\n                index = (this.groupData.length + index) % this.groupData.length;\n            }\n            this.groupIndex = index;\n            this.loadImage(this.groupData[index].src, () => {\n                this._triggerHook('changed', [\n                    this,\n                    index\n                ]);\n            }, () => {\n                this._triggerHook('changed', [\n                    this,\n                    index\n                ]);\n            });\n        }\n        zoom(ratio, origin, e) {\n            this._imager.zoom(ratio,origin,e);\n        }\n        zoomTo(ratio, origin, e) {\n            this._imager.zoomTo(ratio,origin,e);\n        }\n        rotate(angle) {\n            this._imager.rotate(angle);\n        }\n        rotateTo(angle) {\n            this._imager.rotateTo(angle);\n        }\n        resize() {\n            return this._imager.resize();\n        }\n        maximize() {\n            this._window.maximize();\n        }\n        fullscreen() {\n            this._window.fullscreen();\n        }\n        _keydown(e) {\n            if (!this.options.keyboard) {\n                return false;\n            }\n            const keyCode = e.keyCode || e.which || e.charCode;\n            const ctrlKey = e.ctrlKey || e.metaKey;\n            const altKey = e.altKey || e.metaKey;\n            switch (keyCode) {\n                // ←\n                case 37:\n                    this.jump(-1);\n                    break;\n                // →\n                case 39:\n                    this.jump(1);\n                    break;\n                // Q\n                case 81:\n                    this.close();\n                    break;\n                default:\n            }\n        }\n        _addEvents() {\n\n            this.$zoomIn.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoom(this.options.ratioThreshold * 3, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$zoomOut.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoom(-this.options.ratioThreshold * 3, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$actualSize.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoomTo(1, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$prev.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.jump(-1);\n            });\n\n            this.$next.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.jump(1);\n            });\n            this.$rotateLeft.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.rotate(-90);\n            });\n            this.$rotateRight.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.rotate(90);\n            });\n\n            this.$photoviewer.off(Constants.KEYDOWN_EVENT + Constants.EVENT_NS).on(Constants.KEYDOWN_EVENT + Constants.EVENT_NS, e => {\n                this._keydown(e);\n            });\n            ///Constants.$W.on(Constants.RESIZE_EVENT + Constants.EVENT_NS, this.resize());\n        }\n        _addCustomButtonEvents() {\n            for (const btnKey in this.options.customButtons) {\n                this.$photoviewer.find(Constants.CLASS_NS + '-button-' + btnKey).off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                    this.options.customButtons[btnKey].click.apply(this, [\n                        this,\n                        e\n                    ]);\n                });\n            }\n        }\n        _triggerHook(e, data) {\n            if (this.options.callbacks[e]) {\n                this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\n            }\n        }\n    }\n    //$.extend(PhotoViewer.prototype, draggable, movable, resizable);\n\n    ///$.extend(PhotoViewer.prototype, movable);\n\n    window.PhotoViewer = PhotoViewer;\n    return PhotoViewer;\n});"]}