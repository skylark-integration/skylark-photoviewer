{"version":3,"sources":["core.js"],"names":["define","$","DEFAULTS","Constants","Utilities","Window","Imager","PhotoViewer","[object Object]","items","options","el","this","extend","isArray","footerToolbar","headerToolbar","$el","isOpened","isMaximized","isRotated","rotateAngle","isDoResize","imageData","modalData","width","height","left","top","init","opts","groupData","groupIndex","PUBLIC_VARS","imgSrc","open","loadImage","toolbar","btns","btnsHTML","each","index","item","btnClass","NS","indexOf","i18n","icons","customButtons","title","text","_createBtns","_createTitle","photoviewerHTML","_createTemplate","$photoviewer","$stage","find","CLASS_NS","$title","$image","$close","$maximize","$minimize","$zoomIn","$zoomOut","$actualSize","$fullscreen","$rotateLeft","$rotateRight","$prev","$next","addClass","css","dragHandle","appendTo","eq","append","_window","_imager","_addEvents","_addCustomButtonEvents","on","resize","_triggerHook","multiInstances","remove","length","fixedContent","overflow","hasScrollbar","scrollbarWidth","getScrollbarWidth","padding-right","build","setModalPos","get","focus","close","modal","winWidth","$W","winHeight","scrollLeft","$D","scrollTop","modalWidth","modalHeight","initMaximized","img","stageCSS","right","bottom","borderLeft","borderRight","borderTop","borderBottom","parseFloat","gapThreshold","scale","Math","min","minWidth","max","minHeight","modalCSSObj","fixedModalSize","round","initAnimation","animate","setImageSize","fn","err","setModalSize","call","setImageTitle","url","getImageNameFromUrl","html","step","jumpTo","src","ratio","origin","e","zoom","zoomTo","angle","rotate","rotateTo","maximize","fullscreen","keyboard","keyCode","which","charCode","ctrlKey","metaKey","altKey","jump","off","CLICK_EVENT","EVENT_NS","ratioThreshold","x","y","KEYDOWN_EVENT","_keydown","btnKey","click","apply","data","callbacks","window"],"mappings":"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","file":"../core.js","sourcesContent":["define([\n    './domq',\n    './defaults',\n    './constants',\n    './utilities',\n    \"./window\",\n    \"./picture_viewer\"\n], function ($, DEFAULTS, Constants, Utilities, Window,Imager) {\n    'use strict';\n\n    \n    class PhotoViewer {\n        constructor(items, options, el) {\n            this.options = $.extend(true, {}, DEFAULTS, options);\n            if (options && $.isArray(options.footerToolbar)) {\n                this.options.footerToolbar = options.footerToolbar;\n            }\n            if (options && $.isArray(options.headerToolbar)) {\n                this.options.headerToolbar = options.headerToolbar;\n            }\n            this.$el = $(el);\n            this.isOpened = false;\n            this.isMaximized = false;\n            this.isRotated = false;\n            this.rotateAngle = 0;\n            this.isDoResize = false;\n            this.imageData = {};\n            this.modalData = {\n                width: null,\n                height: null,\n                left: null,\n                top: null\n            };\n            this.init(items, this.options);\n        }\n        init(items, opts) {\n            this.groupData = items;\n            this.groupIndex = opts['index'];\n            Constants.PUBLIC_VARS['zIndex'] = Constants.PUBLIC_VARS['zIndex'] === 0 ? opts['zIndex'] : Constants.PUBLIC_VARS['zIndex'];\n            const imgSrc = items[this.groupIndex]['src'];\n            this.open();\n            this.loadImage(imgSrc);\n            ///if (opts.draggable) {\n            ///    this.draggable(this.$photoviewer, this.dragHandle, Constants.CLASS_NS + '-button');\n            ///}\n            ///if (opts.movable) {\n            ///    this.movable(this.$stage, this.$image);\n            ///}\n            ///if (opts.resizable) {\n            ///    this.resizable(this.$photoviewer, this.$stage, this.$image, opts.modalWidth, opts.modalHeight);\n            ///}\n        }\n        _createBtns(toolbar) {\n            const btns = [\n                'minimize',\n                'maximize',\n                'close',\n                'zoomIn',\n                'zoomOut',\n                'prev',\n                'next',\n                'fullscreen',\n                'actualSize',\n                'rotateLeft',\n                'rotateRight'\n            ];\n            let btnsHTML = '';\n            $.each(toolbar, (index, item) => {\n                const btnClass = `${ Constants.NS }-button ${ Constants.NS }-button-${ item }`;\n                if (btns.indexOf(item) >= 0) {\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.i18n[item] }\">\n          ${ this.options.icons[item] }\n          </button>`;\n                } else if (this.options.customButtons[item]) {\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.customButtons[item].title || '' }\">\n          ${ this.options.customButtons[item].text }\n          </button>`;\n                }\n            });\n            return btnsHTML;\n        }\n        _createTitle() {\n            return this.options.title ? `<div class=\"${ Constants.NS }-title\"></div>` : '';\n        }\n        _createTemplate() {\n            const photoviewerHTML = `<div class=\"${ Constants.NS }-modal\" tabindex=\"0\">\n        <div class=\"${ Constants.NS }-inner\">\n          <div class=\"${ Constants.NS }-header\">\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-header\">\n            ${ this._createBtns(this.options.headerToolbar) }\n            </div>\n            ${ this._createTitle() }\n          </div>\n          <div class=\"${ Constants.NS }-stage\">\n            <img class=\"${ Constants.NS }-image\" src=\"\" alt=\"\" />\n          </div>\n          <div class=\"${ Constants.NS }-footer\">\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-footer\">\n            ${ this._createBtns(this.options.footerToolbar) }\n            </div>\n          </div>\n        </div>\n      </div>`;\n            return photoviewerHTML;\n        }\n        build() {\n            const photoviewerHTML = this._createTemplate();\n            const $photoviewer = $(photoviewerHTML);\n            this.$photoviewer = $photoviewer;\n            this.$stage = $photoviewer.find(Constants.CLASS_NS + '-stage');\n            this.$title = $photoviewer.find(Constants.CLASS_NS + '-title');\n            this.$image = $photoviewer.find(Constants.CLASS_NS + '-image');\n            this.$close = $photoviewer.find(Constants.CLASS_NS + '-button-close');\n            this.$maximize = $photoviewer.find(Constants.CLASS_NS + '-button-maximize');\n            this.$minimize = $photoviewer.find(Constants.CLASS_NS + '-button-minimize');\n            this.$zoomIn = $photoviewer.find(Constants.CLASS_NS + '-button-zoomIn');\n            this.$zoomOut = $photoviewer.find(Constants.CLASS_NS + '-button-zoomOut');\n            this.$actualSize = $photoviewer.find(Constants.CLASS_NS + '-button-actualSize');\n            this.$fullscreen = $photoviewer.find(Constants.CLASS_NS + '-button-fullscreen');\n            this.$rotateLeft = $photoviewer.find(Constants.CLASS_NS + '-button-rotateLeft');\n            this.$rotateRight = $photoviewer.find(Constants.CLASS_NS + '-button-rotateRight');\n            this.$prev = $photoviewer.find(Constants.CLASS_NS + '-button-prev');\n            this.$next = $photoviewer.find(Constants.CLASS_NS + '-button-next');\n            this.$stage.addClass('stage-ready');\n            this.$image.addClass('image-ready');\n            this.$photoviewer.css('z-index', Constants.PUBLIC_VARS['zIndex']);\n            if (!this.options.dragHandle || this.options.dragHandle === Constants.CLASS_NS + '-modal') {\n                this.dragHandle = this.$photoviewer;\n            } else {\n                this.dragHandle = this.$photoviewer.find(this.options.dragHandle);\n            }\n            $(this.options.appendTo).eq(0).append(this.$photoviewer);\n\n            this._window = new Window(this.$photoviewer[0],{\n                dragHandle : this.options.dragHandle,\n\n            });\n            this._imager = new Imager(this.$stage[0]);\n\n            this._addEvents();\n            this._addCustomButtonEvents();\n\n            this.$photoviewer.on(\"resized\",()=>{\n                this._imager.resize();;\n            });\n        }\n        open() {\n            this._triggerHook('beforeOpen', this);\n            if (!this.options.multiInstances) {\n                $(Constants.CLASS_NS + '-modal').eq(0).remove();\n            }\n            if (!$(Constants.CLASS_NS + '-modal').length && this.options.fixedContent) {\n                $('html').css({ overflow: 'hidden' });\n                if (Utilities.hasScrollbar()) {\n                    const scrollbarWidth = Utilities.getScrollbarWidth();\n                    if (scrollbarWidth) {\n                        $('html').css({ 'padding-right': scrollbarWidth });\n                    }\n                }\n            }\n            this.build();\n            this.setModalPos(this.$photoviewer);\n            this.$photoviewer.get(0).focus();\n            this._triggerHook('opened', this);\n        }\n        close() {\n            this._window.close();\n        }\n        setModalPos(modal) {\n            const winWidth = Constants.$W.width();\n            const winHeight = Constants.$W.height();\n            const scrollLeft = Constants.$D.scrollLeft();\n            const scrollTop = Constants.$D.scrollTop();\n            const modalWidth = this.options.modalWidth;\n            const modalHeight = this.options.modalHeight;\n            if (this.options.initMaximized) {\n                modal.addClass(Constants.NS + '-maximize');\n                modal.css({\n                    width: '100%',\n                    height: '100%',\n                    left: 0,\n                    top: 0\n                });\n                this.isOpened = true;\n                this.isMaximized = true;\n            } else {\n                modal.css({\n                    width: modalWidth,\n                    height: modalHeight,\n                    left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\n                    top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\n                });\n            }\n        }\n        setModalSize(img) {\n            const winWidth = Constants.$W.width();\n            const winHeight = Constants.$W.height();\n            const scrollLeft = Constants.$D.scrollLeft();\n            const scrollTop = Constants.$D.scrollTop();\n            const stageCSS = {\n                left: this.$stage.css('left'),\n                right: this.$stage.css('right'),\n                top: this.$stage.css('top'),\n                bottom: this.$stage.css('bottom'),\n                borderLeft: this.$stage.css('border-left-width'),\n                borderRight: this.$stage.css('border-right-width'),\n                borderTop: this.$stage.css('border-top-width'),\n                borderBottom: this.$stage.css('border-bottom-width')\n            };\n            const modalWidth = img.width + parseFloat(stageCSS.left) + parseFloat(stageCSS.right) + parseFloat(stageCSS.borderLeft) + parseFloat(stageCSS.borderRight);\n            const modalHeight = img.height + parseFloat(stageCSS.top) + parseFloat(stageCSS.bottom) + parseFloat(stageCSS.borderTop) + parseFloat(stageCSS.borderBottom);\n            const gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1;\n            const scale = Math.min(winWidth / (modalWidth * gapThreshold), winHeight / (modalHeight * gapThreshold), 1);\n            let minWidth = Math.max(modalWidth * scale, this.options.modalWidth);\n            let minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\n            minWidth = this.options.fixedModalSize ? this.options.modalWidth : Math.round(minWidth);\n            minHeight = this.options.fixedModalSize ? this.options.modalHeight : Math.round(minHeight);\n            const modalCSSObj = {\n                width: minWidth + 'px',\n                height: minHeight + 'px',\n                left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\n                top: (winHeight - minHeight) / 2 + scrollTop + 'px'\n            };\n            if (this.options.initAnimation) {\n                this.$photoviewer.animate(modalCSSObj, 400, 'ease-in-out', () => {\n                    this.setImageSize(img);\n                });\n            } else {\n                this.$photoviewer.css(modalCSSObj);\n                this.setImageSize(img);\n            }\n            this.isOpened = true;\n        }\n\n        setImageSize(img) {\n            this._imager.setImageSize(img);\n        }\n        loadImage(imgSrc, fn, err) {\n            this._imager.loadImage(imgSrc,(img) => {\n                this.setModalSize(img);\n                if (fn) {\n                    fn.call();\n                }\n            },err);\n            if (this.options.title) {\n                this.setImageTitle(imgSrc);\n            }\n        }\n        setImageTitle(url) {\n            const title = this.groupData[this.groupIndex].title || Utilities.getImageNameFromUrl(url);\n            this.$title.html(title);\n        }\n        jump(step) {\n            this._triggerHook('beforeChange', [\n                this,\n                this.groupIndex\n            ]);\n            this.groupIndex = this.groupIndex + step;\n            this.jumpTo(this.groupIndex);\n        }\n        jumpTo(index) {\n            index = index % this.groupData.length;\n            if (index >= 0) {\n                index = index % this.groupData.length;\n            } else if (index < 0) {\n                index = (this.groupData.length + index) % this.groupData.length;\n            }\n            this.groupIndex = index;\n            this.loadImage(this.groupData[index].src, () => {\n                this._triggerHook('changed', [\n                    this,\n                    index\n                ]);\n            }, () => {\n                this._triggerHook('changed', [\n                    this,\n                    index\n                ]);\n            });\n        }\n        zoom(ratio, origin, e) {\n            this._imager.zoom(ratio,origin,e);\n        }\n        zoomTo(ratio, origin, e) {\n            this._imager.zoomTo(ratio,origin,e);\n        }\n        rotate(angle) {\n            this._imager.rotate(angle);\n        }\n        rotateTo(angle) {\n            this._imager.rotateTo(angle);\n        }\n        resize() {\n            return this._imager.resize();\n        }\n        maximize() {\n            this._window.maximize();\n        }\n        fullscreen() {\n            this._window.fullscreen();\n        }\n        _keydown(e) {\n            if (!this.options.keyboard) {\n                return false;\n            }\n            const keyCode = e.keyCode || e.which || e.charCode;\n            const ctrlKey = e.ctrlKey || e.metaKey;\n            const altKey = e.altKey || e.metaKey;\n            switch (keyCode) {\n                // ←\n                case 37:\n                    this.jump(-1);\n                    break;\n                // →\n                case 39:\n                    this.jump(1);\n                    break;\n                // Q\n                case 81:\n                    this.close();\n                    break;\n                default:\n            }\n        }\n        _addEvents() {\n\n            this.$zoomIn.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoom(this.options.ratioThreshold * 3, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$zoomOut.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoom(-this.options.ratioThreshold * 3, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$actualSize.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoomTo(1, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$prev.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.jump(-1);\n            });\n\n            this.$next.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.jump(1);\n            });\n            this.$rotateLeft.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.rotate(-90);\n            });\n            this.$rotateRight.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.rotate(90);\n            });\n\n            this.$photoviewer.off(Constants.KEYDOWN_EVENT + Constants.EVENT_NS).on(Constants.KEYDOWN_EVENT + Constants.EVENT_NS, e => {\n                this._keydown(e);\n            });\n            ///Constants.$W.on(Constants.RESIZE_EVENT + Constants.EVENT_NS, this.resize());\n        }\n        _addCustomButtonEvents() {\n            for (const btnKey in this.options.customButtons) {\n                this.$photoviewer.find(Constants.CLASS_NS + '-button-' + btnKey).off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                    this.options.customButtons[btnKey].click.apply(this, [\n                        this,\n                        e\n                    ]);\n                });\n            }\n        }\n        _triggerHook(e, data) {\n            if (this.options.callbacks[e]) {\n                this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\n            }\n        }\n    }\n    //$.extend(PhotoViewer.prototype, draggable, movable, resizable);\n\n    ///$.extend(PhotoViewer.prototype, movable);\n\n    window.PhotoViewer = PhotoViewer;\n    return PhotoViewer;\n});"]}