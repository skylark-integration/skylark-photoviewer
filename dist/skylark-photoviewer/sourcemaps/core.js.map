{"version":3,"sources":["core.js"],"names":["define","Imager","Window","$","DEFAULTS","Constants","Utilities","PhotoViewer","[object Object]","items","options","el","this","extend","isArray","footerToolbar","headerToolbar","$el","isOpened","isMaximized","isRotated","rotateAngle","isDoResize","imageData","modalData","width","height","left","top","init","opts","groupData","groupIndex","PUBLIC_VARS","imgSrc","open","loadImage","toolbar","btns","btnsHTML","each","index","item","btnClass","NS","indexOf","i18n","icons","customButtons","title","text","_createBtns","_createTitle","photoviewerHTML","_createTemplate","$photoviewer","$stage","find","CLASS_NS","$title","$image","$close","$maximize","$minimize","$zoomIn","$zoomOut","$actualSize","$fullscreen","$rotateLeft","$rotateRight","$prev","$next","addClass","css","dragHandle","appendTo","eq","append","_window","selectors","headerPane","contentPane","footerPane","titlebar","buttons","fullscreen","maximize","minimize","close","classes","fixedContent","initMaximized","movable","dragCancel","resizable","minWidth","minHeight","border","all","right","bottom","topLeft","topRight","bottomLeft","bottomRight","_imager","ratioThreshold","minRatio","maxRatio","grab","loader","_addEvents","_addCustomButtonEvents","on","resize","_triggerHook","multiInstances","remove","length","overflow","hasScrollbar","scrollbarWidth","getScrollbarWidth","padding-right","build","setModalPos","get","focus","modal","winWidth","$W","winHeight","scrollLeft","$D","scrollTop","modalWidth","modalHeight","img","stageCSS","borderLeft","borderRight","borderTop","borderBottom","parseFloat","gapThreshold","scale","Math","min","max","modalCSSObj","fixedModalSize","round","initAnimation","animate","setImageSize","fn","err","setModalSize","call","setImageTitle","url","getImageNameFromUrl","html","step","jumpTo","src","ratio","origin","e","zoom","zoomTo","angle","rotate","rotateTo","keyboard","keyCode","which","charCode","ctrlKey","metaKey","altKey","jump","off","CLICK_EVENT","EVENT_NS","x","y","KEYDOWN_EVENT","_keydown","btnKey","click","apply","data","callbacks","window"],"mappings":"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","file":"../core.js","sourcesContent":["define([\n    \"skylark-domx-plugins-pictures/viewer\",\n    \"skylark-domx-plugins-windows/window\",\n    './domq',\n    './defaults',\n    './constants',\n    './utilities'\n], function (Imager,Window,$, DEFAULTS, Constants, Utilities) {\n    'use strict';\n\n    \n    class PhotoViewer {\n        constructor(items, options, el) {\n            this.options = $.extend(true, {}, DEFAULTS, options);\n            if (options && $.isArray(options.footerToolbar)) {\n                this.options.footerToolbar = options.footerToolbar;\n            }\n            if (options && $.isArray(options.headerToolbar)) {\n                this.options.headerToolbar = options.headerToolbar;\n            }\n            this.$el = $(el);\n            this.isOpened = false;\n            this.isMaximized = false;\n            this.isRotated = false;\n            this.rotateAngle = 0;\n            this.isDoResize = false;\n            this.imageData = {};\n            this.modalData = {\n                width: null,\n                height: null,\n                left: null,\n                top: null\n            };\n            this.init(items, this.options);\n        }\n        init(items, opts) {\n            this.groupData = items;\n            this.groupIndex = opts['index'];\n            Constants.PUBLIC_VARS['zIndex'] = Constants.PUBLIC_VARS['zIndex'] === 0 ? opts['zIndex'] : Constants.PUBLIC_VARS['zIndex'];\n            const imgSrc = items[this.groupIndex]['src'];\n            this.open();\n            this.loadImage(imgSrc);\n            ///if (opts.draggable) {\n            ///    this.draggable(this.$photoviewer, this.dragHandle, Constants.CLASS_NS + '-button');\n            ///}\n            ///if (opts.movable) {\n            ///    this.movable(this.$stage, this.$image);\n            ///}\n            ///if (opts.resizable) {\n            ///    this.resizable(this.$photoviewer, this.$stage, this.$image, opts.modalWidth, opts.modalHeight);\n            ///}\n        }\n        _createBtns(toolbar) {\n            const btns = [\n                'minimize',\n                'maximize',\n                'close',\n                'zoomIn',\n                'zoomOut',\n                'prev',\n                'next',\n                'fullscreen',\n                'actualSize',\n                'rotateLeft',\n                'rotateRight'\n            ];\n            let btnsHTML = '';\n            $.each(toolbar, (index, item) => {\n                const btnClass = `${ Constants.NS }-button ${ Constants.NS }-button-${ item }`;\n                if (btns.indexOf(item) >= 0) {\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.i18n[item] }\">\n          ${ this.options.icons[item] }\n          </button>`;\n                } else if (this.options.customButtons[item]) {\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.customButtons[item].title || '' }\">\n          ${ this.options.customButtons[item].text }\n          </button>`;\n                }\n            });\n            return btnsHTML;\n        }\n        _createTitle() {\n            return this.options.title ? `<div class=\"${ Constants.NS }-title\"></div>` : '';\n        }\n        _createTemplate() {\n            const photoviewerHTML = `<div class=\"${ Constants.NS }-modal\" tabindex=\"0\">\n        <div class=\"${ Constants.NS }-inner\">\n          <div class=\"${ Constants.NS }-header\">\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-header\">\n            ${ this._createBtns(this.options.headerToolbar) }\n            </div>\n            ${ this._createTitle() }\n          </div>\n          <div class=\"${ Constants.NS }-stage\">\n            <img class=\"${ Constants.NS }-image\" src=\"\" alt=\"\" />\n          </div>\n          <div class=\"${ Constants.NS }-footer\">\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-footer\">\n            ${ this._createBtns(this.options.footerToolbar) }\n            </div>\n          </div>\n        </div>\n      </div>`;\n            return photoviewerHTML;\n        }\n        build() {\n            const photoviewerHTML = this._createTemplate();\n            const $photoviewer = $(photoviewerHTML);\n            this.$photoviewer = $photoviewer;\n            this.$stage = $photoviewer.find(Constants.CLASS_NS + '-stage');\n            this.$title = $photoviewer.find(Constants.CLASS_NS + '-title');\n            this.$image = $photoviewer.find(Constants.CLASS_NS + '-image');\n            this.$close = $photoviewer.find(Constants.CLASS_NS + '-button-close');\n            this.$maximize = $photoviewer.find(Constants.CLASS_NS + '-button-maximize');\n            this.$minimize = $photoviewer.find(Constants.CLASS_NS + '-button-minimize');\n            this.$zoomIn = $photoviewer.find(Constants.CLASS_NS + '-button-zoomIn');\n            this.$zoomOut = $photoviewer.find(Constants.CLASS_NS + '-button-zoomOut');\n            this.$actualSize = $photoviewer.find(Constants.CLASS_NS + '-button-actualSize');\n            this.$fullscreen = $photoviewer.find(Constants.CLASS_NS + '-button-fullscreen');\n            this.$rotateLeft = $photoviewer.find(Constants.CLASS_NS + '-button-rotateLeft');\n            this.$rotateRight = $photoviewer.find(Constants.CLASS_NS + '-button-rotateRight');\n            this.$prev = $photoviewer.find(Constants.CLASS_NS + '-button-prev');\n            this.$next = $photoviewer.find(Constants.CLASS_NS + '-button-next');\n            this.$stage.addClass('stage-ready');\n            this.$image.addClass('image-ready');\n            this.$photoviewer.css('z-index', Constants.PUBLIC_VARS['zIndex']);\n            if (!this.options.dragHandle || this.options.dragHandle === Constants.CLASS_NS + '-modal') {\n                this.dragHandle = this.$photoviewer;\n            } else {\n                this.dragHandle = this.$photoviewer.find(this.options.dragHandle);\n            }\n            $(this.options.appendTo).eq(0).append(this.$photoviewer);\n\n            this._window = new Window(this.$photoviewer[0],{\n                selectors : {\n                    headerPane  : \"\",\n                    contentPane : \"\",\n                    footerPane  : \"\",\n                    titlebar : \"\",\n                    buttons : {\n                        \"fullscreen\" : \".photoviewer-button-fullscreen\",\n                        \"maximize\" : \".photoviewer-button-maximize\",\n                        \"minimize\" : \".photoviewer-button-minimize\",     \n                        \"close\" : \".photoviewer-button-close\"\n                    }\n                },\n                classes : {\n                    \"maximize\" : Constants.NS + '-maximize',\n                },\n                fixedContent: true,\n                initMaximized: false,\n\n\n\n                movable : {\n\n                    dragHandle: this.options.dragHandle,\n                    dragCancel: Constants.CLASS_NS + '-button'\n                },\n                resizable : {\n                    minWidth: 320,\n                    minHeight: 320,\n                    border : {\n                        classes :  {\n                            all : `${ Constants.NS }-resizable-handle`,\n                            top : `${ Constants.NS }-resizable-handle-n`,\n                            left: `${ Constants.NS }-resizable-handle-w`,\n                            right: `${ Constants.NS }-resizable-handle-e`,\n                            bottom: `${ Constants.NS }-resizable-handle-s`, \n                            topLeft : `${ Constants.NS }-resizable-handle-nw`, \n                            topRight : `${ Constants.NS }-resizable-handle-ne`,\n                            bottomLeft : `${ Constants.NS }-resizable-handle-sw`,             \n                            bottomRight : `${ Constants.NS }-resizable-handle-se`   \n                        }\n                    }\n                }\n            });\n            this._imager = new Imager(this.$stage[0],{\n                ratioThreshold: this.options.ratioThreshold,\n                minRatio: this.options.minRatio,\n                maxRatio: this.options.maxRatio,\n                movable : true,\n\n                classes : {\n                    grab : \"is-grab\",\n                    loader : \"${ Constants.NS }-loader\"\n                }                \n            });\n\n            this._addEvents();\n            this._addCustomButtonEvents();\n\n            this.$photoviewer.on(\"resized\",()=>{\n                this._imager.resize();;\n            });\n        }\n        open() {\n            this._triggerHook('beforeOpen', this);\n            if (!this.options.multiInstances) {\n                $(Constants.CLASS_NS + '-modal').eq(0).remove();\n            }\n            if (!$(Constants.CLASS_NS + '-modal').length && this.options.fixedContent) {\n                $('html').css({ overflow: 'hidden' });\n                if (Utilities.hasScrollbar()) {\n                    const scrollbarWidth = Utilities.getScrollbarWidth();\n                    if (scrollbarWidth) {\n                        $('html').css({ 'padding-right': scrollbarWidth });\n                    }\n                }\n            }\n            this.build();\n            this.setModalPos(this.$photoviewer);\n            this.$photoviewer.get(0).focus();\n            this._triggerHook('opened', this);\n        }\n        close() {\n            this._window.close();\n        }\n        setModalPos(modal) {\n            const winWidth = Constants.$W.width();\n            const winHeight = Constants.$W.height();\n            const scrollLeft = Constants.$D.scrollLeft();\n            const scrollTop = Constants.$D.scrollTop();\n            const modalWidth = this.options.modalWidth;\n            const modalHeight = this.options.modalHeight;\n            if (this.options.initMaximized) {\n                modal.addClass(Constants.NS + '-maximize');\n                modal.css({\n                    width: '100%',\n                    height: '100%',\n                    left: 0,\n                    top: 0\n                });\n                this.isOpened = true;\n                this.isMaximized = true;\n            } else {\n                modal.css({\n                    width: modalWidth,\n                    height: modalHeight,\n                    left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\n                    top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\n                });\n            }\n        }\n        setModalSize(img) {\n            const winWidth = Constants.$W.width();\n            const winHeight = Constants.$W.height();\n            const scrollLeft = Constants.$D.scrollLeft();\n            const scrollTop = Constants.$D.scrollTop();\n            const stageCSS = {\n                left: this.$stage.css('left'),\n                right: this.$stage.css('right'),\n                top: this.$stage.css('top'),\n                bottom: this.$stage.css('bottom'),\n                borderLeft: this.$stage.css('border-left-width'),\n                borderRight: this.$stage.css('border-right-width'),\n                borderTop: this.$stage.css('border-top-width'),\n                borderBottom: this.$stage.css('border-bottom-width')\n            };\n            const modalWidth = img.width + parseFloat(stageCSS.left) + parseFloat(stageCSS.right) + parseFloat(stageCSS.borderLeft) + parseFloat(stageCSS.borderRight);\n            const modalHeight = img.height + parseFloat(stageCSS.top) + parseFloat(stageCSS.bottom) + parseFloat(stageCSS.borderTop) + parseFloat(stageCSS.borderBottom);\n            const gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1;\n            const scale = Math.min(winWidth / (modalWidth * gapThreshold), winHeight / (modalHeight * gapThreshold), 1);\n            let minWidth = Math.max(modalWidth * scale, this.options.modalWidth);\n            let minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\n            minWidth = this.options.fixedModalSize ? this.options.modalWidth : Math.round(minWidth);\n            minHeight = this.options.fixedModalSize ? this.options.modalHeight : Math.round(minHeight);\n            const modalCSSObj = {\n                width: minWidth + 'px',\n                height: minHeight + 'px',\n                left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\n                top: (winHeight - minHeight) / 2 + scrollTop + 'px'\n            };\n            if (this.options.initAnimation) {\n                this.$photoviewer.animate(modalCSSObj, 400, 'ease-in-out', () => {\n                    this.setImageSize(img);\n                });\n            } else {\n                this.$photoviewer.css(modalCSSObj);\n                this.setImageSize(img);\n            }\n            this.isOpened = true;\n        }\n\n        setImageSize(img) {\n            this._imager.setImageSize(img);\n        }\n        loadImage(imgSrc, fn, err) {\n            this._imager.loadImage(imgSrc,(img) => {\n                this.setModalSize(img);\n                if (fn) {\n                    fn.call();\n                }\n            },err);\n            if (this.options.title) {\n                this.setImageTitle(imgSrc);\n            }\n        }\n        setImageTitle(url) {\n            const title = this.groupData[this.groupIndex].title || Utilities.getImageNameFromUrl(url);\n            this.$title.html(title);\n        }\n        jump(step) {\n            this._triggerHook('beforeChange', [\n                this,\n                this.groupIndex\n            ]);\n            this.groupIndex = this.groupIndex + step;\n            this.jumpTo(this.groupIndex);\n        }\n        jumpTo(index) {\n            index = index % this.groupData.length;\n            if (index >= 0) {\n                index = index % this.groupData.length;\n            } else if (index < 0) {\n                index = (this.groupData.length + index) % this.groupData.length;\n            }\n            this.groupIndex = index;\n            this.loadImage(this.groupData[index].src, () => {\n                this._triggerHook('changed', [\n                    this,\n                    index\n                ]);\n            }, () => {\n                this._triggerHook('changed', [\n                    this,\n                    index\n                ]);\n            });\n        }\n        zoom(ratio, origin, e) {\n            this._imager.zoom(ratio,origin,e);\n        }\n        zoomTo(ratio, origin, e) {\n            this._imager.zoomTo(ratio,origin,e);\n        }\n        rotate(angle) {\n            this._imager.rotate(angle);\n        }\n        rotateTo(angle) {\n            this._imager.rotateTo(angle);\n        }\n        resize() {\n            return this._imager.resize();\n        }\n        maximize() {\n            this._window.maximize();\n        }\n        fullscreen() {\n            this._window.fullscreen();\n        }\n        _keydown(e) {\n            if (!this.options.keyboard) {\n                return false;\n            }\n            const keyCode = e.keyCode || e.which || e.charCode;\n            const ctrlKey = e.ctrlKey || e.metaKey;\n            const altKey = e.altKey || e.metaKey;\n            switch (keyCode) {\n                // ←\n                case 37:\n                    this.jump(-1);\n                    break;\n                // →\n                case 39:\n                    this.jump(1);\n                    break;\n                // Q\n                case 81:\n                    this.close();\n                    break;\n                default:\n            }\n        }\n        _addEvents() {\n\n            this.$zoomIn.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoom(this.options.ratioThreshold * 3, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$zoomOut.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoom(-this.options.ratioThreshold * 3, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$actualSize.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                this.zoomTo(1, {\n                    x: this.$stage.width() / 2,\n                    y: this.$stage.height() / 2\n                }, e);\n            });\n            this.$prev.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.jump(-1);\n            });\n\n            this.$next.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.jump(1);\n            });\n            this.$rotateLeft.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.rotate(-90);\n            });\n            this.$rotateRight.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\n                this.rotate(90);\n            });\n\n            this.$photoviewer.off(Constants.KEYDOWN_EVENT + Constants.EVENT_NS).on(Constants.KEYDOWN_EVENT + Constants.EVENT_NS, e => {\n                this._keydown(e);\n            });\n            ///Constants.$W.on(Constants.RESIZE_EVENT + Constants.EVENT_NS, this.resize());\n        }\n        _addCustomButtonEvents() {\n            for (const btnKey in this.options.customButtons) {\n                this.$photoviewer.find(Constants.CLASS_NS + '-button-' + btnKey).off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\n                    this.options.customButtons[btnKey].click.apply(this, [\n                        this,\n                        e\n                    ]);\n                });\n            }\n        }\n        _triggerHook(e, data) {\n            if (this.options.callbacks[e]) {\n                this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\n            }\n        }\n    }\n    //$.extend(PhotoViewer.prototype, draggable, movable, resizable);\n\n    ///$.extend(PhotoViewer.prototype, movable);\n\n    window.PhotoViewer = PhotoViewer;\n    return PhotoViewer;\n});"]}