{"version":3,"sources":["core.js"],"names":["define","Imager","Window","$","DEFAULTS","Constants","Utilities","PhotoViewer","[object Object]","items","options","el","this","extend","isArray","footerToolbar","headerToolbar","$el","isOpened","isMaximized","isRotated","rotateAngle","isDoResize","imageData","modalData","width","height","left","top","init","opts","groupData","groupIndex","PUBLIC_VARS","imgSrc","open","loadImage","toolbar","btns","btnsHTML","each","index","item","btnClass","NS","indexOf","i18n","icons","customButtons","title","text","_createBtns","_createTitle","photoviewerHTML","_createTemplate","$photoviewer","$stage","find","CLASS_NS","$title","$image","$close","$maximize","$minimize","$zoomIn","$zoomOut","$actualSize","$fullscreen","$rotateLeft","$rotateRight","$prev","$next","addClass","css","dragHandle","appendTo","eq","append","_window","selectors","headerPane","contentPane","footerPane","titlebar","buttons","fullscreen","maximize","minimize","close","classes","fixedContent","initMaximized","movable","dragCancel","resizable","minWidth","minHeight","border","all","right","bottom","topLeft","topRight","bottomLeft","bottomRight","_imager","ratioThreshold","minRatio","maxRatio","grab","loader","_addEvents","_addCustomButtonEvents","on","resize","_triggerHook","multiInstances","remove","length","overflow","hasScrollbar","scrollbarWidth","getScrollbarWidth","padding-right","build","setModalPos","get","focus","modal","winWidth","$W","winHeight","scrollLeft","$D","scrollTop","modalWidth","modalHeight","img","stageCSS","borderLeft","borderRight","borderTop","borderBottom","parseFloat","gapThreshold","scale","Math","min","max","modalCSSObj","fixedModalSize","round","initAnimation","animate","setImageSize","fn","err","setModalSize","call","setImageTitle","url","getImageNameFromUrl","html","step","jumpTo","src","ratio","origin","e","zoom","zoomTo","angle","rotate","rotateTo","keyboard","keyCode","which","charCode","ctrlKey","metaKey","altKey","jump","off","CLICK_EVENT","EVENT_NS","x","y","KEYDOWN_EVENT","_keydown","btnKey","click","apply","data","callbacks","window"],"mappings":"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","file":"../core.js","sourcesContent":["define([\r\n    \"skylark-domx-plugins-pictures/viewer\",\r\n    \"skylark-domx-plugins-panels/floating\",\r\n    './domq',\r\n    './defaults',\r\n    './constants',\r\n    './utilities'\r\n], function (Imager,Window,$, DEFAULTS, Constants, Utilities) {\r\n    'use strict';\r\n\r\n    \r\n    class PhotoViewer {\r\n        constructor(items, options, el) {\r\n            this.options = $.extend(true, {}, DEFAULTS, options);\r\n            if (options && $.isArray(options.footerToolbar)) {\r\n                this.options.footerToolbar = options.footerToolbar;\r\n            }\r\n            if (options && $.isArray(options.headerToolbar)) {\r\n                this.options.headerToolbar = options.headerToolbar;\r\n            }\r\n            this.$el = $(el);\r\n            this.isOpened = false;\r\n            this.isMaximized = false;\r\n            this.isRotated = false;\r\n            this.rotateAngle = 0;\r\n            this.isDoResize = false;\r\n            this.imageData = {};\r\n            this.modalData = {\r\n                width: null,\r\n                height: null,\r\n                left: null,\r\n                top: null\r\n            };\r\n            this.init(items, this.options);\r\n        }\r\n        init(items, opts) {\r\n            this.groupData = items;\r\n            this.groupIndex = opts['index'];\r\n            Constants.PUBLIC_VARS['zIndex'] = Constants.PUBLIC_VARS['zIndex'] === 0 ? opts['zIndex'] : Constants.PUBLIC_VARS['zIndex'];\r\n            const imgSrc = items[this.groupIndex]['src'];\r\n            this.open();\r\n            this.loadImage(imgSrc);\r\n            ///if (opts.draggable) {\r\n            ///    this.draggable(this.$photoviewer, this.dragHandle, Constants.CLASS_NS + '-button');\r\n            ///}\r\n            ///if (opts.movable) {\r\n            ///    this.movable(this.$stage, this.$image);\r\n            ///}\r\n            ///if (opts.resizable) {\r\n            ///    this.resizable(this.$photoviewer, this.$stage, this.$image, opts.modalWidth, opts.modalHeight);\r\n            ///}\r\n        }\r\n        _createBtns(toolbar) {\r\n            const btns = [\r\n                'minimize',\r\n                'maximize',\r\n                'close',\r\n                'zoomIn',\r\n                'zoomOut',\r\n                'prev',\r\n                'next',\r\n                'fullscreen',\r\n                'actualSize',\r\n                'rotateLeft',\r\n                'rotateRight'\r\n            ];\r\n            let btnsHTML = '';\r\n            $.each(toolbar, (index, item) => {\r\n                const btnClass = `${ Constants.NS }-button ${ Constants.NS }-button-${ item }`;\r\n                if (btns.indexOf(item) >= 0) {\r\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.i18n[item] }\">\r\n          ${ this.options.icons[item] }\r\n          </button>`;\r\n                } else if (this.options.customButtons[item]) {\r\n                    btnsHTML += `<button class=\"${ btnClass }\" title=\"${ this.options.customButtons[item].title || '' }\">\r\n          ${ this.options.customButtons[item].text }\r\n          </button>`;\r\n                }\r\n            });\r\n            return btnsHTML;\r\n        }\r\n        _createTitle() {\r\n            return this.options.title ? `<div class=\"${ Constants.NS }-title\"></div>` : '';\r\n        }\r\n        _createTemplate() {\r\n            const photoviewerHTML = `<div class=\"${ Constants.NS }-modal\" tabindex=\"0\">\r\n        <div class=\"${ Constants.NS }-inner\">\r\n          <div class=\"${ Constants.NS }-header\">\r\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-header\">\r\n            ${ this._createBtns(this.options.headerToolbar) }\r\n            </div>\r\n            ${ this._createTitle() }\r\n          </div>\r\n          <div class=\"${ Constants.NS }-stage\">\r\n            <img class=\"${ Constants.NS }-image\" src=\"\" alt=\"\" />\r\n          </div>\r\n          <div class=\"${ Constants.NS }-footer\">\r\n            <div class=\"${ Constants.NS }-toolbar ${ Constants.NS }-toolbar-footer\">\r\n            ${ this._createBtns(this.options.footerToolbar) }\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>`;\r\n            return photoviewerHTML;\r\n        }\r\n        build() {\r\n            const photoviewerHTML = this._createTemplate();\r\n            const $photoviewer = $(photoviewerHTML);\r\n            this.$photoviewer = $photoviewer;\r\n            this.$stage = $photoviewer.find(Constants.CLASS_NS + '-stage');\r\n            this.$title = $photoviewer.find(Constants.CLASS_NS + '-title');\r\n            this.$image = $photoviewer.find(Constants.CLASS_NS + '-image');\r\n            this.$close = $photoviewer.find(Constants.CLASS_NS + '-button-close');\r\n            this.$maximize = $photoviewer.find(Constants.CLASS_NS + '-button-maximize');\r\n            this.$minimize = $photoviewer.find(Constants.CLASS_NS + '-button-minimize');\r\n            this.$zoomIn = $photoviewer.find(Constants.CLASS_NS + '-button-zoomIn');\r\n            this.$zoomOut = $photoviewer.find(Constants.CLASS_NS + '-button-zoomOut');\r\n            this.$actualSize = $photoviewer.find(Constants.CLASS_NS + '-button-actualSize');\r\n            this.$fullscreen = $photoviewer.find(Constants.CLASS_NS + '-button-fullscreen');\r\n            this.$rotateLeft = $photoviewer.find(Constants.CLASS_NS + '-button-rotateLeft');\r\n            this.$rotateRight = $photoviewer.find(Constants.CLASS_NS + '-button-rotateRight');\r\n            this.$prev = $photoviewer.find(Constants.CLASS_NS + '-button-prev');\r\n            this.$next = $photoviewer.find(Constants.CLASS_NS + '-button-next');\r\n            this.$stage.addClass('stage-ready');\r\n            this.$image.addClass('image-ready');\r\n            this.$photoviewer.css('z-index', Constants.PUBLIC_VARS['zIndex']);\r\n            if (!this.options.dragHandle || this.options.dragHandle === Constants.CLASS_NS + '-modal') {\r\n                this.dragHandle = this.$photoviewer;\r\n            } else {\r\n                this.dragHandle = this.$photoviewer.find(this.options.dragHandle);\r\n            }\r\n            $(this.options.appendTo).eq(0).append(this.$photoviewer);\r\n\r\n            this._window = new Window(this.$photoviewer[0],{\r\n                selectors : {\r\n                    headerPane  : \"\",\r\n                    contentPane : \"\",\r\n                    footerPane  : \"\",\r\n                    titlebar : \"\",\r\n                    buttons : {\r\n                        \"fullscreen\" : \".photoviewer-button-fullscreen\",\r\n                        \"maximize\" : \".photoviewer-button-maximize\",\r\n                        \"minimize\" : \".photoviewer-button-minimize\",     \r\n                        \"close\" : \".photoviewer-button-close\"\r\n                    }\r\n                },\r\n                classes : {\r\n                    \"maximize\" : Constants.NS + '-maximize',\r\n                },\r\n                fixedContent: true,\r\n                initMaximized: false,\r\n\r\n\r\n\r\n                movable : {\r\n\r\n                    dragHandle: this.options.dragHandle,\r\n                    dragCancel: Constants.CLASS_NS + '-button'\r\n                },\r\n                resizable : {\r\n                    minWidth: 320,\r\n                    minHeight: 320,\r\n                    border : {\r\n                        classes :  {\r\n                            all : `${ Constants.NS }-resizable-handle`,\r\n                            top : `${ Constants.NS }-resizable-handle-n`,\r\n                            left: `${ Constants.NS }-resizable-handle-w`,\r\n                            right: `${ Constants.NS }-resizable-handle-e`,\r\n                            bottom: `${ Constants.NS }-resizable-handle-s`, \r\n                            topLeft : `${ Constants.NS }-resizable-handle-nw`, \r\n                            topRight : `${ Constants.NS }-resizable-handle-ne`,\r\n                            bottomLeft : `${ Constants.NS }-resizable-handle-sw`,             \r\n                            bottomRight : `${ Constants.NS }-resizable-handle-se`   \r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            this._imager = new Imager(this.$stage[0],{\r\n                ratioThreshold: this.options.ratioThreshold,\r\n                minRatio: this.options.minRatio,\r\n                maxRatio: this.options.maxRatio,\r\n                movable : true,\r\n\r\n                classes : {\r\n                    grab : \"is-grab\",\r\n                    loader : \"${ Constants.NS }-loader\"\r\n                }                \r\n            });\r\n\r\n            this._addEvents();\r\n            this._addCustomButtonEvents();\r\n\r\n            this.$photoviewer.on(\"resized\",()=>{\r\n                this._imager.resize();;\r\n            });\r\n        }\r\n        open() {\r\n            this._triggerHook('beforeOpen', this);\r\n            if (!this.options.multiInstances) {\r\n                $(Constants.CLASS_NS + '-modal').eq(0).remove();\r\n            }\r\n            if (!$(Constants.CLASS_NS + '-modal').length && this.options.fixedContent) {\r\n                $('html').css({ overflow: 'hidden' });\r\n                if (Utilities.hasScrollbar()) {\r\n                    const scrollbarWidth = Utilities.getScrollbarWidth();\r\n                    if (scrollbarWidth) {\r\n                        $('html').css({ 'padding-right': scrollbarWidth });\r\n                    }\r\n                }\r\n            }\r\n            this.build();\r\n            this.setModalPos(this.$photoviewer);\r\n            this.$photoviewer.get(0).focus();\r\n            this._triggerHook('opened', this);\r\n        }\r\n        close() {\r\n            this._window.close();\r\n        }\r\n        setModalPos(modal) {\r\n            const winWidth = Constants.$W.width();\r\n            const winHeight = Constants.$W.height();\r\n            const scrollLeft = Constants.$D.scrollLeft();\r\n            const scrollTop = Constants.$D.scrollTop();\r\n            const modalWidth = this.options.modalWidth;\r\n            const modalHeight = this.options.modalHeight;\r\n            if (this.options.initMaximized) {\r\n                modal.addClass(Constants.NS + '-maximize');\r\n                modal.css({\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    left: 0,\r\n                    top: 0\r\n                });\r\n                this.isOpened = true;\r\n                this.isMaximized = true;\r\n            } else {\r\n                modal.css({\r\n                    width: modalWidth,\r\n                    height: modalHeight,\r\n                    left: (winWidth - modalWidth) / 2 + scrollLeft + 'px',\r\n                    top: (winHeight - modalHeight) / 2 + scrollTop + 'px'\r\n                });\r\n            }\r\n        }\r\n        setModalSize(img) {\r\n            const winWidth = Constants.$W.width();\r\n            const winHeight = Constants.$W.height();\r\n            const scrollLeft = Constants.$D.scrollLeft();\r\n            const scrollTop = Constants.$D.scrollTop();\r\n            const stageCSS = {\r\n                left: this.$stage.css('left'),\r\n                right: this.$stage.css('right'),\r\n                top: this.$stage.css('top'),\r\n                bottom: this.$stage.css('bottom'),\r\n                borderLeft: this.$stage.css('border-left-width'),\r\n                borderRight: this.$stage.css('border-right-width'),\r\n                borderTop: this.$stage.css('border-top-width'),\r\n                borderBottom: this.$stage.css('border-bottom-width')\r\n            };\r\n            const modalWidth = img.width + parseFloat(stageCSS.left) + parseFloat(stageCSS.right) + parseFloat(stageCSS.borderLeft) + parseFloat(stageCSS.borderRight);\r\n            const modalHeight = img.height + parseFloat(stageCSS.top) + parseFloat(stageCSS.bottom) + parseFloat(stageCSS.borderTop) + parseFloat(stageCSS.borderBottom);\r\n            const gapThreshold = (this.options.gapThreshold > 0 ? this.options.gapThreshold : 0) + 1;\r\n            const scale = Math.min(winWidth / (modalWidth * gapThreshold), winHeight / (modalHeight * gapThreshold), 1);\r\n            let minWidth = Math.max(modalWidth * scale, this.options.modalWidth);\r\n            let minHeight = Math.max(modalHeight * scale, this.options.modalHeight);\r\n            minWidth = this.options.fixedModalSize ? this.options.modalWidth : Math.round(minWidth);\r\n            minHeight = this.options.fixedModalSize ? this.options.modalHeight : Math.round(minHeight);\r\n            const modalCSSObj = {\r\n                width: minWidth + 'px',\r\n                height: minHeight + 'px',\r\n                left: (winWidth - minWidth) / 2 + scrollLeft + 'px',\r\n                top: (winHeight - minHeight) / 2 + scrollTop + 'px'\r\n            };\r\n            if (this.options.initAnimation) {\r\n                this.$photoviewer.animate(modalCSSObj, 400, 'ease-in-out', () => {\r\n                    this.setImageSize(img);\r\n                });\r\n            } else {\r\n                this.$photoviewer.css(modalCSSObj);\r\n                this.setImageSize(img);\r\n            }\r\n            this.isOpened = true;\r\n        }\r\n\r\n        setImageSize(img) {\r\n            this._imager.setImageSize(img);\r\n        }\r\n        loadImage(imgSrc, fn, err) {\r\n            this._imager.loadImage(imgSrc,(img) => {\r\n                this.setModalSize(img);\r\n                if (fn) {\r\n                    fn.call();\r\n                }\r\n            },err);\r\n            if (this.options.title) {\r\n                this.setImageTitle(imgSrc);\r\n            }\r\n        }\r\n        setImageTitle(url) {\r\n            const title = this.groupData[this.groupIndex].title || Utilities.getImageNameFromUrl(url);\r\n            this.$title.html(title);\r\n        }\r\n        jump(step) {\r\n            this._triggerHook('beforeChange', [\r\n                this,\r\n                this.groupIndex\r\n            ]);\r\n            this.groupIndex = this.groupIndex + step;\r\n            this.jumpTo(this.groupIndex);\r\n        }\r\n        jumpTo(index) {\r\n            index = index % this.groupData.length;\r\n            if (index >= 0) {\r\n                index = index % this.groupData.length;\r\n            } else if (index < 0) {\r\n                index = (this.groupData.length + index) % this.groupData.length;\r\n            }\r\n            this.groupIndex = index;\r\n            this.loadImage(this.groupData[index].src, () => {\r\n                this._triggerHook('changed', [\r\n                    this,\r\n                    index\r\n                ]);\r\n            }, () => {\r\n                this._triggerHook('changed', [\r\n                    this,\r\n                    index\r\n                ]);\r\n            });\r\n        }\r\n        zoom(ratio, origin, e) {\r\n            this._imager.zoom(ratio,origin,e);\r\n        }\r\n        zoomTo(ratio, origin, e) {\r\n            this._imager.zoomTo(ratio,origin,e);\r\n        }\r\n        rotate(angle) {\r\n            this._imager.rotate(angle);\r\n        }\r\n        rotateTo(angle) {\r\n            this._imager.rotateTo(angle);\r\n        }\r\n        resize() {\r\n            return this._imager.resize();\r\n        }\r\n        maximize() {\r\n            this._window.maximize();\r\n        }\r\n        fullscreen() {\r\n            this._window.fullscreen();\r\n        }\r\n        _keydown(e) {\r\n            if (!this.options.keyboard) {\r\n                return false;\r\n            }\r\n            const keyCode = e.keyCode || e.which || e.charCode;\r\n            const ctrlKey = e.ctrlKey || e.metaKey;\r\n            const altKey = e.altKey || e.metaKey;\r\n            switch (keyCode) {\r\n                // ←\r\n                case 37:\r\n                    this.jump(-1);\r\n                    break;\r\n                // →\r\n                case 39:\r\n                    this.jump(1);\r\n                    break;\r\n                // Q\r\n                case 81:\r\n                    this.close();\r\n                    break;\r\n                default:\r\n            }\r\n        }\r\n        _addEvents() {\r\n\r\n            this.$zoomIn.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\r\n                this.zoom(this.options.ratioThreshold * 3, {\r\n                    x: this.$stage.width() / 2,\r\n                    y: this.$stage.height() / 2\r\n                }, e);\r\n            });\r\n            this.$zoomOut.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\r\n                this.zoom(-this.options.ratioThreshold * 3, {\r\n                    x: this.$stage.width() / 2,\r\n                    y: this.$stage.height() / 2\r\n                }, e);\r\n            });\r\n            this.$actualSize.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\r\n                this.zoomTo(1, {\r\n                    x: this.$stage.width() / 2,\r\n                    y: this.$stage.height() / 2\r\n                }, e);\r\n            });\r\n            this.$prev.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\r\n                this.jump(-1);\r\n            });\r\n\r\n            this.$next.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\r\n                this.jump(1);\r\n            });\r\n            this.$rotateLeft.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\r\n                this.rotate(-90);\r\n            });\r\n            this.$rotateRight.off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, () => {\r\n                this.rotate(90);\r\n            });\r\n\r\n            this.$photoviewer.off(Constants.KEYDOWN_EVENT + Constants.EVENT_NS).on(Constants.KEYDOWN_EVENT + Constants.EVENT_NS, e => {\r\n                this._keydown(e);\r\n            });\r\n            ///Constants.$W.on(Constants.RESIZE_EVENT + Constants.EVENT_NS, this.resize());\r\n        }\r\n        _addCustomButtonEvents() {\r\n            for (const btnKey in this.options.customButtons) {\r\n                this.$photoviewer.find(Constants.CLASS_NS + '-button-' + btnKey).off(Constants.CLICK_EVENT + Constants.EVENT_NS).on(Constants.CLICK_EVENT + Constants.EVENT_NS, e => {\r\n                    this.options.customButtons[btnKey].click.apply(this, [\r\n                        this,\r\n                        e\r\n                    ]);\r\n                });\r\n            }\r\n        }\r\n        _triggerHook(e, data) {\r\n            if (this.options.callbacks[e]) {\r\n                this.options.callbacks[e].apply(this, $.isArray(data) ? data : [data]);\r\n            }\r\n        }\r\n    }\r\n    //$.extend(PhotoViewer.prototype, draggable, movable, resizable);\r\n\r\n    ///$.extend(PhotoViewer.prototype, movable);\r\n\r\n    window.PhotoViewer = PhotoViewer;\r\n    return PhotoViewer;\r\n});"]}