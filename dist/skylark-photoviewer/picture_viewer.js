/**
 * skylark-photoviewer - A version of dat.gui.js  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-photoviewer/
 * @license MIT
 */
define(["skylark-domx-eventer","skylark-domx-plugins-base","skylark-domx-plugins-interact/movable","skylark-jquery","./constants","./utilities"],function(t,i,h,s,a,o){"use strict";return i.Plugin.inherit({klassName:"Imager",pluginName:"lark.domx.imager",options:{ratioThreshold:.1,minRatio:.05,maxRatio:16,movable:!0},_construct:function(e,s){i.Plugin.prototype._construct.call(this,e,s),this.$stage=this.$(),this.$image=this.$stage.find("img"),this.$stage.off(a.WHEEL_EVENT+a.EVENT_NS).on(a.WHEEL_EVENT+a.EVENT_NS,t=>{this._handleWheel(t)}),this.options.movable&&(this._movable=new h(this.$image[0],{starting:t=>{if(!this.$stage.hasClass("is-grab"))return!1;const i=this.$image.width(),e=this.$image.height(),h=this.$stage.width(),s=this.$stage.height();let a,o,g,n;return h>=i?a=g=(h-i)/2:(a=h-i,g=0),s>=e?o=n=(s-e)/2:(o=s-e,n=0),{constraints:{minX:a,maxX:g,minY:o,maxY:n}}},started:function(i){t.stop(i)}}))},getImageScaleToStage:function(t,i){let e=1;return e=this.isRotated?Math.min(t/this.img.height,i/this.img.width,1):Math.min(t/this.img.width,i/this.img.height,1)},setImageSize:function(t){const i={w:this.$stage.width(),h:this.$stage.height()},e=this.getImageScaleToStage(i.w,i.h);this.$image.css({width:Math.ceil(t.width*e)+"px",height:Math.ceil(t.height*e)+"px",left:(i.w-Math.ceil(t.width*e))/2+"px",top:(i.h-Math.ceil(t.height*e))/2+"px"}),s.extend(this.imageData,{initWidth:t.width*e,initHeight:t.height*e,initLeft:(i.w-t.width*e)/2,initTop:(i.h-t.height*e)/2,width:t.width*e,height:t.height*e,left:(i.w-t.width*e)/2,top:(i.h-t.height*e)/2}),o.setGrabCursor({w:this.$image.width(),h:this.$image.height()},{w:this.$stage.width(),h:this.$stage.height()},this.$stage,this.isRotated),this.imageLoaded||(this.$stage.find(a.CLASS_NS+"-loader").remove(),this.$stage.removeClass("stage-ready"),this.$image.removeClass("image-ready"),this.options.initAnimation&&!this.options.progressiveLoading&&this.$image.fadeIn(),this.imageLoaded=!0)},loadImage:function(t,i,e){this.$image.removeAttr("style").attr("src",""),this.isRotated=!1,this.rotateAngle=0,this.imageLoaded=!1,this.$stage.append(`<div class="${a.NS}-loader"></div>`),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.options.initAnimation&&!this.options.progressiveLoading&&this.$image.hide(),this.$image.attr("src",t),o.preloadImage(t,t=>{this.img=t,this.imageData={originalWidth:t.width,originalHeight:t.height},i&&i(t)},()=>{this.$photoviewer.find(a.CLASS_NS+"-loader").remove(),e&&e.call()})},_handleWheel:function(t){t.preventDefault();let i=1;t.deltaY?i=t.deltaY>0?1:-1:t.wheelDelta?i=-t.wheelDelta/120:t.detail&&(i=t.detail>0?1:-1);const e=-i*this.options.ratioThreshold,h={x:t.clientX-this.$stage.offset().left+a.$D.scrollLeft(),y:t.clientY-this.$stage.offset().top+a.$D.scrollTop()};this.zoom(e,h,t)},zoom:function(t,i,e){t=t<0?1/(1-t):1+t,(t=this.$image.width()/this.imageData.originalWidth*t)>this.options.maxRatio||t<this.options.minRatio||this.zoomTo(t,i,e)},zoomTo:function(t,i,e){const h=this.$image,a=this.$stage,g=this.imageData.width,n=this.imageData.height,r=this.imageData.left,d=this.imageData.top,m={w:a.width(),h:a.height(),x:a.offset().left,y:a.offset().top},l=this.imageData.originalWidth*t,$=this.imageData.originalHeight*t;let c=i.x-(i.x-r)/g*l,w=i.y-(i.y-d)/n*$;const p=this.isRotated?(l-$)/2:0,f=this.isRotated?$:l,u=this.isRotated?l:$,x=m.w-l,y=m.h-$;w=u<=m.h?(m.h-$)/2:w>p?p:w>y-p?w:y-p,c=f<=m.w?(m.w-l)/2:c>-p?-p:c>x+p?c:x+p,Math.abs(this.imageData.initWidth-l)<.05*this.imageData.initWidth?this.setImageSize(this.img):(h.css({width:Math.round(l)+"px",height:Math.round($)+"px",left:Math.round(c)+"px",top:Math.round(w)+"px"}),o.setGrabCursor({w:Math.round(f),h:Math.round(u)},{w:m.w,h:m.h},this.$stage)),s.extend(this.imageData,{width:l,height:$,left:c,top:w})},rotate:function(t){this.rotateAngle=this.rotateAngle+t,this.rotateAngle/90%2==0?this.isRotated=!1:this.isRotated=!0,this.rotateTo(this.rotateAngle)},rotateTo:function(t){this.$image.css({transform:"rotate("+t+"deg)"}),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}),this.$stage.removeClass("is-grab")},resize:function(){const t=this.$image.width(),i=this.$image.height(),e=(this.$stage.width()-t)/2,h=(this.$stage.height()-i)/2;this.$image.css({left:e,top:h})},shortcut:function(t,i,h){var s=!1;switch(t){case 187:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},e),s=!0;break;case 189:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},e),s=!0;break;case 61:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},e),s=!0;break;case 173:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},e),s=!0;break;case 48:i&&h&&this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},e),s=!0;break;case 188:i&&this.rotate(-90);break;case 190:i&&this.rotate(90),s=!0}return s}})});
//# sourceMappingURL=sourcemaps/picture_viewer.js.map
