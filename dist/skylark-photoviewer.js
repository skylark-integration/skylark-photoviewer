/**
 * skylark-photoviewer - A version of dat.gui.js  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-photoviewer/
 * @license MIT
 */
!function(t,i){var e=i.define,require=i.require,o="function"==typeof e&&e.amd,s=!o&&"undefined"!=typeof exports;if(!o&&!e){var a={};e=i.define=function(t,i,e){"function"==typeof e?(a[t]={factory:e,deps:i.map(function(i){return function(t,i){if("."!==t[0])return t;var e=i.split("/"),o=t.split("/");e.pop();for(var s=0;s<o.length;s++)"."!=o[s]&&(".."==o[s]?e.pop():e.push(o[s]));return e.join("/")}(i,t)}),resolved:!1,exports:null},require(t)):a[t]={factory:null,resolved:!0,exports:e}},require=i.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=a[t];if(!module.resolved){var e=[];module.deps.forEach(function(t){e.push(require(t))}),module.exports=module.factory.apply(i,e)||null,module.resolved=!0}return module.exports}}if(!e)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-photoviewer/domq",["skylark-jquery"],function(t){"use strict";return t}),t("skylark-photoviewer/defaults",["./domq"],function(t){"use strict";return{draggable:!0,resizable:!0,movable:!0,keyboard:!0,title:!0,modalWidth:320,modalHeight:320,fixedContent:!0,fixedModalSize:!1,initMaximized:!1,gapThreshold:.02,ratioThreshold:.1,minRatio:.05,maxRatio:16,headerToolbar:["maximize","close"],footerToolbar:["zoomIn","zoomOut","prev","fullscreen","next","actualSize","rotateRight"],icons:{minimize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M20,14H4V10H20"></path>\n      </svg>',maximize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M4,4H20V20H4V4M6,8V18H18V8H6Z"></path>\n      </svg>',close:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M13.46,12L19,17.54V19H17.54L12,13.46L6.46,19H5V17.54L10.54,12\n        L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46L13.46,12Z"></path>\n      </svg>',zoomIn:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43\n        C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5\n        C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5\n        C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z"></path>\n      </svg>',zoomOut:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M15.5,14H14.71L14.43,13.73C15.41,12.59 16,11.11 16,9.5\n        A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,6.5 0 0,0 9.5,16\n        C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5L19,20.5L20.5,19L15.5,14M9.5,14\n        C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z"></path>\n      </svg>',prev:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"></path>\n      </svg>',next:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M16,18H18V6H16M6,18L14.5,12L6,6V18Z"></path>\n      </svg>',fullscreen:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M8.5,12.5L11,15.5L14.5,11L19,17H5M23,18V6A2,2 0 0,0 21,4H3\n        A2,2 0 0,0 1,6V18A2,2 0 0,0 3,20H21A2,2 0 0,0 23,18Z"></path>\n      </svg>',actualSize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M9.5,13.09L10.91,14.5L6.41,19H10V21H3V14H5V17.59L9.5,13.09\n        M10.91,9.5L9.5,10.91L5,6.41V10H3V3H10V5H6.41L10.91,9.5M14.5,13.09L19,17.59V14H21V21H14V19\n        H17.59L13.09,14.5L14.5,13.09M13.09,9.5L17.59,5H14V3H21V10H19V6.41L14.5,10.91\n        L13.09,9.5Z"></path>\n      </svg>',rotateLeft:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M13,4.07V1L8.45,5.55L13,10V6.09C15.84,6.57 18,9.03 18,12\n        C18,14.97 15.84,17.43 13,17.91V19.93C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07\n        M7.1,18.32C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,16.87L7.1,18.32\n        M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13\n        M7.11,8.53L5.7,7.11C4.8,8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z"></path>\n      </svg>',rotateRight:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91\n        C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31\n        L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11\n        L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12\n        C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10\n        L15.55,5.55Z"></path>\n      </svg>'},i18n:{minimize:"minimize",maximize:"maximize",close:"close",zoomIn:"zoom-in (+)",zoomOut:"zoom-out (-)",prev:"prev (←)",next:"next (→)",fullscreen:"fullscreen",actualSize:"actual-size (Ctrl+Alt+0)",rotateLeft:"rotate-left (Ctrl+,)",rotateRight:"rotate-right (Ctrl+.)"},multiInstances:!0,initAnimation:!0,fixedModalPos:!1,zIndex:1090,dragHandle:!1,callbacks:{beforeOpen:t.noop,opened:t.noop,beforeClose:t.noop,closed:t.noop,beforeChange:t.noop,changed:t.noop},index:0,progressiveLoading:!0,appendTo:"body",customButtons:{}}}),t("skylark-photoviewer/utilities",["skylark-langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-geom","skylark-domx-images"],function(t,i,e,o,s){"use strict";const a=window.document;return{document:a,throttle:t.debounce,preloadImage:function(t,i,e){s.preload(t).then(function(t){i(t.imgs[0])},e)},requestFullscreen:e.fullscreen,exitFullscreen:e.fullscreen,getImageNameFromUrl:function(t){return t.replace(/^.*?\/*([^/?]*)\.[a-z]+(\?.+|$)/gi,"$1")},hasScrollbar:o.hasScrollbar,getScrollbarWidth:o.scrollbarWidth,setGrabCursor:function(t,i,e,o){const s=o?t.h:t.w,a=o?t.w:t.h;(a>i.h||s>i.w)&&e.addClass("is-grab");a<=i.h&&s<=i.w&&e.removeClass("is-grab")},supportTouch:function(){return i.support.tocuh}}}),t("skylark-photoviewer/constants",["./domq","./utilities"],function(t,i){"use strict";const e=t(window),o=t(i.document),s=i.supportTouch()?"touchstart":"mousedown",a=i.supportTouch()?"touchmove":"mousemove",h=i.supportTouch()?"touchend":"mouseup",n="photoviewer";return{$W:e,$D:o,CLICK_EVENT:"click",RESIZE_EVENT:"resize",KEYDOWN_EVENT:"keydown",WHEEL_EVENT:"wheel mousewheel DOMMouseScroll",TOUCH_START_EVENT:s,TOUCH_MOVE_EVENT:a,TOUCH_END_EVENT:h,NS:n,CLASS_NS:".photoviewer",EVENT_NS:".photoviewer",PUBLIC_VARS:{isMoving:!1,isResizing:!1,zIndex:0}}}),t("skylark-domx-plugins-interact/movable",["skylark-langx/langx","skylark-domx-noder","skylark-domx-data","skylark-domx-geom","skylark-domx-eventer","skylark-domx-styler","skylark-domx-plugins","./interact"],function(t,i,e,o,s,a,h,n){s.on,s.off,e.attr,e.removeAttr,o.pagePosition,a.addClass,o.height,Array.prototype.some,Array.prototype.map;var r=h.Plugin.inherit({klassName:"Movable",pluginName:"lark.movable",_construct:function(e,h){function n(t){var i,e;if(t.changedTouches)for(i="screenX screenY pageX pageY clientX clientY".split(" "),e=0;e<i.length;e++)t[i[e]]=t.changedTouches[0][i[e]]}function r(t){t.movable=c,t.moveEl=e,t.handleEl=m}this.overrided(e,h);var l,d,p,g,c=this,m=(h=this.options).handle||e,u=!1!==h.auto,f=h.constraints,w=h.document||document,x=h.starting,v=h.started,S=h.moving,N=h.stopped,E=function(t){if(n(t),r(t),0!==t.button)return $(t);if(t.deltaX=t.screenX-d,t.deltaY=t.screenY-p,u){var i=g.left+t.deltaX,s=g.top+t.deltaY;f&&(i<f.minX&&(i=f.minX),i>f.maxX&&(i=f.maxX),s<f.minY&&(s=f.minY),s>f.maxY&&(s=f.maxY))}o.relativePosition(e,{left:i,top:s}),t.preventDefault(),S&&S(t)},$=function(t){n(t),s.off(w,"mousemove touchmove",E).off(w,"mouseup touchend",$),i.remove(l),N&&N(t)};s.on(m,"mousedown touchstart",function(h){var c,u=o.getDocumentSize(w);if(n(h),r(h),x){var C=x(h);if(!1===C)return;t.isPlainObject(C)&&(C.constraints&&(f=C.constraints),C.started&&(v=C.started),C.moving&&(S=C.moving),C.stopped&&(N=C.stopped))}h.preventDefault(),h.button,d=h.screenX,p=h.screenY,g=o.relativePosition(e),o.size(e),c=a.css(m,"curosr"),l=i.createElement("div"),a.css(l,{position:"absolute",top:0,left:0,width:u.width,height:u.height,zIndex:2147483647,opacity:1e-4,cursor:c}),i.append(w.body,l),s.on(w,"mousemove touchmove",E).on(w,"mouseup touchend",$),v&&v(h)}),this._handleEl=m},remove:function(){s.off(this._handleEl)}});return h.register(r,"movable"),n.Movable=r}),t("skylark-photoviewer/draggable",["skylark-domx-plugins-interact/movable","./domq","./constants"],function(t,i,e){"use strict";return{draggable(e,o,s){t(i(e)[0])}}}),t("skylark-photoviewer/movable",["skylark-domx-eventer","skylark-domx-plugins-interact/movable","./domq","./constants"],function(t,i,e,o){"use strict";o.NS,o.NS,o.NS,o.NS;return{movable:(o,s)=>i(s[0],{starting:function(t){if(!o.hasClass("is-grab"))return!1;const i=e(s).width(),a=e(s).height(),h=e(o).width(),n=e(o).height();let r,l,d,p;return h>=i?r=d=(h-i)/2:(r=h-i,d=0),n>=a?l=p=(n-a)/2:(l=n-a,p=0),{constraints:{minX:r,maxX:d,minY:l,maxY:p}}},started:function(i){t.stop(i)}})}}),t("skylark-photoviewer/resizable",["./domq","./constants","./utilities"],function(t,i,e){"use strict";const o=`html, body, .${i.NS}-modal, .${i.NS}-stage, .${i.NS}-button`;return{resizable(s,a,h,n,r){const l=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-e"></div>`),d=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-w"></div>`),p=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-s"></div>`),g=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-n"></div>`),c=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-se"></div>`),m=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-sw"></div>`),u=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-ne"></div>`),f=t(`<div class="${i.NS}-resizable-handle ${i.NS}-resizable-handle-nw"></div>`),w={e:l,s:p,se:c,n:g,w:d,nw:f,ne:u,sw:m};t(s).append(l,d,p,g,c,m,u,f);let x=!1,v=0,S=0,N={w:0,h:0,l:0,t:0},E={w:0,h:0,l:0,t:0},$={w:0,h:0,l:0,t:0},C=0,T=0,b=0,_="";const V=(e,n)=>{(n=n||window.event).preventDefault(),x=!0,i.PUBLIC_VARS.isResizing=!0,v="touchstart"===n.type?n.targetTouches[0].pageX:n.clientX,S="touchstart"===n.type?n.targetTouches[0].pageY:n.clientY,N={w:t(s).width(),h:t(s).height(),l:t(s).offset().left,t:t(s).offset().top},E={w:t(a).width(),h:t(a).height(),l:t(a).offset().left,t:t(a).offset().top},$={w:t(h).width(),h:t(h).height(),l:t(h).position().left,t:t(h).position().top},C=this.isRotated?($.w-$.h)/2:0,T=this.isRotated?$.h:$.w,b=this.isRotated?$.w:$.h,_=e,t(o).css("cursor",e+"-resize"),i.$D.on(i.TOUCH_MOVE_EVENT+i.EVENT_NS,z).on(i.TOUCH_END_EVENT+i.EVENT_NS,L)},z=i=>{if((i=i||window.event).preventDefault(),x&&!this.isMaximized){const e="touchmove"===i.type?i.targetTouches[0].pageX:i.clientX,o="touchmove"===i.type?i.targetTouches[0].pageY:i.clientY,a=e-v,l=o-S,d=function(t,i,e){const o=-i+N.w>n?i+N.l:N.l+N.w-n,s=-e+N.h>r?e+N.t:N.t+N.h-r;return{e:{width:Math.max(i+N.w,n)+"px"},s:{height:Math.max(e+N.h,r)+"px"},se:{width:Math.max(i+N.w,n)+"px",height:Math.max(e+N.h,r)+"px"},w:{width:Math.max(-i+N.w,n)+"px",left:o+"px"},n:{height:Math.max(-e+N.h,r)+"px",top:s+"px"},nw:{width:Math.max(-i+N.w,n)+"px",height:Math.max(-e+N.h,r)+"px",top:s+"px",left:o+"px"},ne:{width:Math.max(i+N.w,n)+"px",height:Math.max(-e+N.h,r)+"px",top:s+"px"},sw:{width:Math.max(-i+N.w,n)+"px",height:Math.max(e+N.h,r)+"px",left:o+"px"}}[t]}(_,a,l);t(s).css(d);const p=function(i,e,o){const s=e+N.w>n?E.w-T+e-C:n-(N.w-E.w)-T-C,a=o+N.h>r?E.h-b+o+C:r-(N.h-E.h)-b+C,l=-e+N.w>n?E.w-T-e-C:n-(N.w-E.w)-T-C,d=-o+N.h>r?E.h-b-o+C:r-(N.h-E.h)-b+C,p=(s>0?t(h).position().left:t(h).position().left<0?t(h).position().left:0)-C,g=(a>0?t(h).position().top:t(h).position().top<0?t(h).position().top:0)+C,c=(l>0?t(h).position().left:t(h).position().left<0?t(h).position().left:0)-C,m=(d>0?t(h).position().top:t(h).position().top<0?t(h).position().top:0)+C;return{e:{left:s>=-C?(s-C)/2+"px":p>s?p+"px":s+"px"},s:{top:a>=C?(a+C)/2+"px":g>a?g+"px":a+"px"},se:{top:a>=C?(a+C)/2+"px":g>a?g+"px":a+"px",left:s>=-C?(s-C)/2+"px":p>s?p+"px":s+"px"},w:{left:l>=-C?(l-C)/2+"px":c>l?c+"px":l+"px"},n:{top:d>=C?(d+C)/2+"px":m>d?m+"px":d+"px"},nw:{top:d>=C?(d+C)/2+"px":m>d?m+"px":d+"px",left:l>=-C?(l-C)/2+"px":c>l?c+"px":l+"px"},ne:{top:d>=C?(d+C)/2+"px":m>d?m+"px":d+"px",left:s>=-C?(s-C)/2+"px":p>s?p+"px":s+"px"},sw:{top:a>=C?(a+C)/2+"px":g>a?g+"px":a+"px",left:l>=-C?(l-C)/2+"px":c>l?c+"px":l+"px"}}[i]}(_,a,l);t(h).css(p),this.isDoResize=!0}},L=()=>{i.$D.off(i.TOUCH_MOVE_EVENT+i.EVENT_NS,z).off(i.TOUCH_END_EVENT+i.EVENT_NS,L),i.PUBLIC_VARS.isResizing&&e.setGrabCursor({w:T,h:b},{w:t(a).width(),h:t(a).height()},a),x=!1,i.PUBLIC_VARS.isResizing=!1,t(o).css("cursor","");const s=this.getImageScaleToStage(t(a).width(),t(a).height());t.extend(this.imageData,{initWidth:this.img.width*s,initHeight:this.img.height*s,initLeft:(t(a).width()-this.img.width*s)/2,initTop:(t(a).height()-this.img.height*s)/2})};t.each(w,function(t,e){e.on(i.TOUCH_START_EVENT+i.EVENT_NS,function(i){V(t,i)})})}}}),t("skylark-photoviewer/core",["./domq","./defaults","./constants","./utilities","./draggable","./movable","./resizable"],function(t,i,e,o,s,a,h){"use strict";class n{constructor(e,o,s){this.options=t.extend(!0,{},i,o),o&&t.isArray(o.footerToolbar)&&(this.options.footerToolbar=o.footerToolbar),o&&t.isArray(o.headerToolbar)&&(this.options.headerToolbar=o.headerToolbar),this.$el=t(s),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isDoResize=!1,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(e,this.options)}init(t,i){this.groupData=t,this.groupIndex=i.index,e.PUBLIC_VARS.zIndex=0===e.PUBLIC_VARS.zIndex?i.zIndex:e.PUBLIC_VARS.zIndex;const o=t[this.groupIndex].src;this.open(),this.loadImage(o),i.draggable&&this.draggable(this.$photoviewer,this.dragHandle,e.CLASS_NS+"-button"),i.movable&&this.movable(this.$stage,this.$image),i.resizable&&this.resizable(this.$photoviewer,this.$stage,this.$image,i.modalWidth,i.modalHeight)}_createBtns(i){const o=["minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight"];let s="";return t.each(i,(t,i)=>{const a=`${e.NS}-button ${e.NS}-button-${i}`;o.indexOf(i)>=0?s+=`<button class="${a}" title="${this.options.i18n[i]}">\n          ${this.options.icons[i]}\n          </button>`:this.options.customButtons[i]&&(s+=`<button class="${a}" title="${this.options.customButtons[i].title||""}">\n          ${this.options.customButtons[i].text}\n          </button>`)}),s}_createTitle(){return this.options.title?`<div class="${e.NS}-title"></div>`:""}_createTemplate(){const t=`<div class="${e.NS}-modal" tabindex="0">\n        <div class="${e.NS}-inner">\n          <div class="${e.NS}-header">\n            <div class="${e.NS}-toolbar ${e.NS}-toolbar-header">\n            ${this._createBtns(this.options.headerToolbar)}\n            </div>\n            ${this._createTitle()}\n          </div>\n          <div class="${e.NS}-stage">\n            <img class="${e.NS}-image" src="" alt="" />\n          </div>\n          <div class="${e.NS}-footer">\n            <div class="${e.NS}-toolbar ${e.NS}-toolbar-footer">\n            ${this._createBtns(this.options.footerToolbar)}\n            </div>\n          </div>\n        </div>\n      </div>`;return t}build(){const i=this._createTemplate(),o=t(i);this.$photoviewer=o,this.$stage=o.find(e.CLASS_NS+"-stage"),this.$title=o.find(e.CLASS_NS+"-title"),this.$image=o.find(e.CLASS_NS+"-image"),this.$close=o.find(e.CLASS_NS+"-button-close"),this.$maximize=o.find(e.CLASS_NS+"-button-maximize"),this.$minimize=o.find(e.CLASS_NS+"-button-minimize"),this.$zoomIn=o.find(e.CLASS_NS+"-button-zoomIn"),this.$zoomOut=o.find(e.CLASS_NS+"-button-zoomOut"),this.$actualSize=o.find(e.CLASS_NS+"-button-actualSize"),this.$fullscreen=o.find(e.CLASS_NS+"-button-fullscreen"),this.$rotateLeft=o.find(e.CLASS_NS+"-button-rotateLeft"),this.$rotateRight=o.find(e.CLASS_NS+"-button-rotateRight"),this.$prev=o.find(e.CLASS_NS+"-button-prev"),this.$next=o.find(e.CLASS_NS+"-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$photoviewer.css("z-index",e.PUBLIC_VARS.zIndex),this.options.dragHandle&&this.options.dragHandle!==e.CLASS_NS+"-modal"?this.dragHandle=this.$photoviewer.find(this.options.dragHandle):this.dragHandle=this.$photoviewer,t(this.options.appendTo).eq(0).append(this.$photoviewer),this._addEvents(),this._addCustomButtonEvents()}open(){if(this._triggerHook("beforeOpen",this),this.options.multiInstances||t(e.CLASS_NS+"-modal").eq(0).remove(),!t(e.CLASS_NS+"-modal").length&&this.options.fixedContent&&(t("html").css({overflow:"hidden"}),o.hasScrollbar())){const i=o.getScrollbarWidth();i&&t("html").css({"padding-right":i})}this.build(),this.setModalPos(this.$photoviewer),this.$photoviewer.get(0).focus(),this._triggerHook("opened",this)}close(){this._triggerHook("beforeClose",this),this.$photoviewer.remove(),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,t(e.CLASS_NS+"-modal").length||(this.options.fixedContent&&t("html").css({overflow:"","padding-right":""}),this.options.multiInstances&&(e.PUBLIC_VARS.zIndex=this.options.zIndex),e.$W.off(e.RESIZE_EVENT+e.EVENT_NS)),this._triggerHook("closed",this)}setModalPos(t){const i=e.$W.width(),o=e.$W.height(),s=e.$D.scrollLeft(),a=e.$D.scrollTop(),h=this.options.modalWidth,n=this.options.modalHeight;this.options.initMaximized?(t.addClass(e.NS+"-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:h,height:n,left:(i-h)/2+s+"px",top:(o-n)/2+a+"px"})}setModalSize(t){const i=e.$W.width(),o=e.$W.height(),s=e.$D.scrollLeft(),a=e.$D.scrollTop(),h={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},n=t.width+parseFloat(h.left)+parseFloat(h.right)+parseFloat(h.borderLeft)+parseFloat(h.borderRight),r=t.height+parseFloat(h.top)+parseFloat(h.bottom)+parseFloat(h.borderTop)+parseFloat(h.borderBottom),l=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,d=Math.min(i/(n*l),o/(r*l),1);let p=Math.max(n*d,this.options.modalWidth),g=Math.max(r*d,this.options.modalHeight);p=this.options.fixedModalSize?this.options.modalWidth:Math.round(p),g=this.options.fixedModalSize?this.options.modalHeight:Math.round(g);const c={width:p+"px",height:g+"px",left:(i-p)/2+s+"px",top:(o-g)/2+a+"px"};this.options.initAnimation?this.$photoviewer.animate(c,400,"ease-in-out",()=>{this.setImageSize(t)}):(this.$photoviewer.css(c),this.setImageSize(t)),this.isOpened=!0}getImageScaleToStage(t,i){let e=1;return e=this.isRotated?Math.min(t/this.img.height,i/this.img.width,1):Math.min(t/this.img.width,i/this.img.height,1)}setImageSize(i){const s={w:this.$stage.width(),h:this.$stage.height()},a=this.getImageScaleToStage(s.w,s.h);this.$image.css({width:Math.ceil(i.width*a)+"px",height:Math.ceil(i.height*a)+"px",left:(s.w-Math.ceil(i.width*a))/2+"px",top:(s.h-Math.ceil(i.height*a))/2+"px"}),t.extend(this.imageData,{initWidth:i.width*a,initHeight:i.height*a,initLeft:(s.w-i.width*a)/2,initTop:(s.h-i.height*a)/2,width:i.width*a,height:i.height*a,left:(s.w-i.width*a)/2,top:(s.h-i.height*a)/2}),o.setGrabCursor({w:this.$image.width(),h:this.$image.height()},{w:this.$stage.width(),h:this.$stage.height()},this.$stage,this.isRotated),this.imageLoaded||(this.$photoviewer.find(e.CLASS_NS+"-loader").remove(),this.$stage.removeClass("stage-ready"),this.$image.removeClass("image-ready"),this.options.initAnimation&&!this.options.progressiveLoading&&this.$image.fadeIn(),this.imageLoaded=!0)}loadImage(t,i,s){this.$image.removeAttr("style").attr("src",""),this.isRotated=!1,this.rotateAngle=0,this.imageLoaded=!1,this.$photoviewer.append(`<div class="${e.NS}-loader"></div>`),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.options.initAnimation&&!this.options.progressiveLoading&&this.$image.hide(),this.$image.attr("src",t),o.preloadImage(t,t=>{this.img=t,this.imageData={originalWidth:t.width,originalHeight:t.height},this.isMaximized||this.isOpened&&this.options.fixedModalPos?this.setImageSize(t):this.setModalSize(t),i&&i.call()},()=>{this.$photoviewer.find(e.CLASS_NS+"-loader").remove(),s&&s.call()}),this.options.title&&this.setImageTitle(t)}setImageTitle(t){const i=this.groupData[this.groupIndex].title||o.getImageNameFromUrl(t);this.$title.html(i)}jump(t){this._triggerHook("beforeChange",[this,this.groupIndex]),this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)}jumpTo(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImage(this.groupData[t].src,()=>{this._triggerHook("changed",[this,t])},()=>{this._triggerHook("changed",[this,t])})}wheel(t){t.preventDefault();let i=1;t.deltaY?i=t.deltaY>0?1:-1:t.wheelDelta?i=-t.wheelDelta/120:t.detail&&(i=t.detail>0?1:-1);const o=-i*this.options.ratioThreshold,s={x:t.clientX-this.$stage.offset().left+e.$D.scrollLeft(),y:t.clientY-this.$stage.offset().top+e.$D.scrollTop()};this.zoom(o,s,t)}zoom(t,i,e){t=t<0?1/(1-t):1+t,(t=this.$image.width()/this.imageData.originalWidth*t)>this.options.maxRatio||t<this.options.minRatio||this.zoomTo(t,i,e)}zoomTo(i,e,s){const a=this.$image,h=this.$stage,n={w:this.imageData.width,h:this.imageData.height,x:this.imageData.left,y:this.imageData.top},r={w:h.width(),h:h.height(),x:h.offset().left,y:h.offset().top},l=this.imageData.originalWidth*i,d=this.imageData.originalHeight*i;let p=e.x-(e.x-n.x)/n.w*l,g=e.y-(e.y-n.y)/n.h*d;const c=this.isRotated?(l-d)/2:0,m=this.isRotated?d:l,u=this.isRotated?l:d,f=r.w-l,w=r.h-d;g=u<=r.h?(r.h-d)/2:g>c?c:g>w-c?g:w-c,p=m<=r.w?(r.w-l)/2:p>-c?-c:p>f+c?p:f+c,Math.abs(this.imageData.initWidth-l)<.05*this.imageData.initWidth?this.setImageSize(this.img):(a.css({width:Math.round(l)+"px",height:Math.round(d)+"px",left:Math.round(p)+"px",top:Math.round(g)+"px"}),o.setGrabCursor({w:Math.round(m),h:Math.round(u)},{w:r.w,h:r.h},this.$stage)),t.extend(this.imageData,{width:l,height:d,left:p,top:g})}rotate(t){this.rotateAngle=this.rotateAngle+t,this.rotateAngle/90%2==0?this.isRotated=!1:this.isRotated=!0,this.rotateTo(this.rotateAngle)}rotateTo(t){this.$image.css({transform:"rotate("+t+"deg)"}),this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}),this.$stage.removeClass("is-grab")}resize(){const t=o.throttle(()=>{this.isOpened&&(this.isMaximized?this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}):this.setModalSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight}))},500);return t}maximize(){if(this.$photoviewer.get(0).focus(),this.isMaximized){this.$photoviewer.removeClass(e.NS+"-maximize");const t=(e.$W.width()-this.options.modalWidth)/2+e.$D.scrollLeft(),i=(e.$W.height()-this.options.modalHeight)/2+e.$D.scrollTop();this.$photoviewer.css({width:this.modalData.width?this.modalData.width:this.options.modalWidth,height:this.modalData.height?this.modalData.height:this.options.modalHeight,left:this.modalData.left?this.modalData.left:t,top:this.modalData.top?this.modalData.top:i}),this.isMaximized=!1}else this.modalData={width:this.$photoviewer.width(),height:this.$photoviewer.height(),left:this.$photoviewer.offset().left,top:this.$photoviewer.offset().top},this.$photoviewer.addClass(e.NS+"-maximize"),this.$photoviewer.css({width:"100%",height:"100%",left:0,top:0}),this.isMaximized=!0;this.setImageSize({width:this.imageData.originalWidth,height:this.imageData.originalHeight})}fullscreen(){this.$photoviewer.get(0).focus(),o.requestFullscreen(this.$photoviewer[0])}_keydown(t){if(!this.options.keyboard)return!1;const i=t.keyCode||t.which||t.charCode,e=t.ctrlKey||t.metaKey,o=t.altKey||t.metaKey;switch(i){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 187:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 189:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 61:this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 173:this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 48:e&&o&&this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t);break;case 188:e&&this.rotate(-90);break;case 190:e&&this.rotate(90);break;case 81:this.close()}}_addEvents(){this.$close.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,t=>{this.close()}),this.$stage.off(e.WHEEL_EVENT+e.EVENT_NS).on(e.WHEEL_EVENT+e.EVENT_NS,t=>{this.wheel(t)}),this.$zoomIn.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,t=>{this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$zoomOut.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,t=>{this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$actualSize.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,t=>{this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$prev.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,()=>{this.jump(-1)}),this.$fullscreen.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,()=>{this.fullscreen()}),this.$next.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,()=>{this.jump(1)}),this.$rotateLeft.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,()=>{this.rotate(-90)}),this.$rotateRight.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,()=>{this.rotate(90)}),this.$maximize.off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,()=>{this.maximize()}),this.$photoviewer.off(e.KEYDOWN_EVENT+e.EVENT_NS).on(e.KEYDOWN_EVENT+e.EVENT_NS,t=>{this._keydown(t)}),e.$W.on(e.RESIZE_EVENT+e.EVENT_NS,this.resize())}_addCustomButtonEvents(){for(const t in this.options.customButtons)this.$photoviewer.find(e.CLASS_NS+"-button-"+t).off(e.CLICK_EVENT+e.EVENT_NS).on(e.CLICK_EVENT+e.EVENT_NS,i=>{this.options.customButtons[t].click.apply(this,[this,i])})}_triggerHook(i,e){this.options.callbacks[i]&&this.options.callbacks[i].apply(this,t.isArray(e)?e:[e])}}return t.extend(n.prototype,s,a,h),window.PhotoViewer=n,n}),t("skylark-photoviewer/main",["./core"],function(t){"use strict";return t}),t("skylark-photoviewer",["skylark-photoviewer/main"],function(t){return t})}(e),!o){var h=require("skylark-langx-ns");s?module.exports=h:i.skylarkjs=h}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-photoviewer.js.map
