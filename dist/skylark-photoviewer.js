/**
 * skylark-photoviewer - A version of dat.gui.js  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-photoviewer/
 * @license MIT
 */
!function(t,e){var o=e.define,require=e.require,i="function"==typeof o&&o.amd,s=!i&&"undefined"!=typeof exports;if(!i&&!o){var n={};o=e.define=function(t,e,o){"function"==typeof o?(n[t]={factory:o,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var o=e.split("/"),i=t.split("/");o.pop();for(var s=0;s<i.length;s++)"."!=i[s]&&(".."==i[s]?o.pop():o.push(i[s]));return o.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):n[t]={factory:null,resolved:!0,exports:o}},require=e.require=function(t){if(!n.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=n[t];if(!module.resolved){var o=[];module.deps.forEach(function(t){o.push(require(t))}),module.exports=module.factory.apply(e,o)||null,module.resolved=!0}return module.exports}}if(!o)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-photoviewer/domq",["skylark-jquery"],function(t){"use strict";return t}),t("skylark-photoviewer/defaults",["./domq"],function(t){"use strict";return{draggable:!0,resizable:!0,movable:!0,keyboard:!0,title:!0,modalWidth:320,modalHeight:320,fixedContent:!0,fixedModalSize:!1,initMaximized:!1,gapThreshold:.02,ratioThreshold:.1,minRatio:.05,maxRatio:16,headerToolbar:["maximize","close"],footerToolbar:["zoomIn","zoomOut","prev","fullscreen","next","actualSize","rotateRight"],icons:{minimize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M20,14H4V10H20"></path>\n      </svg>',maximize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M4,4H20V20H4V4M6,8V18H18V8H6Z"></path>\n      </svg>',close:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M13.46,12L19,17.54V19H17.54L12,13.46L6.46,19H5V17.54L10.54,12\n        L5,6.46V5H6.46L12,10.54L17.54,5H19V6.46L13.46,12Z"></path>\n      </svg>',zoomIn:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43\n        C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5\n        C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5\n        C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z"></path>\n      </svg>',zoomOut:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M15.5,14H14.71L14.43,13.73C15.41,12.59 16,11.11 16,9.5\n        A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,6.5 0 0,0 9.5,16\n        C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5L19,20.5L20.5,19L15.5,14M9.5,14\n        C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z"></path>\n      </svg>',prev:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"></path>\n      </svg>',next:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M16,18H18V6H16M6,18L14.5,12L6,6V18Z"></path>\n      </svg>',fullscreen:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M8.5,12.5L11,15.5L14.5,11L19,17H5M23,18V6A2,2 0 0,0 21,4H3\n        A2,2 0 0,0 1,6V18A2,2 0 0,0 3,20H21A2,2 0 0,0 23,18Z"></path>\n      </svg>',actualSize:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M9.5,13.09L10.91,14.5L6.41,19H10V21H3V14H5V17.59L9.5,13.09\n        M10.91,9.5L9.5,10.91L5,6.41V10H3V3H10V5H6.41L10.91,9.5M14.5,13.09L19,17.59V14H21V21H14V19\n        H17.59L13.09,14.5L14.5,13.09M13.09,9.5L17.59,5H14V3H21V10H19V6.41L14.5,10.91\n        L13.09,9.5Z"></path>\n      </svg>',rotateLeft:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M13,4.07V1L8.45,5.55L13,10V6.09C15.84,6.57 18,9.03 18,12\n        C18,14.97 15.84,17.43 13,17.91V19.93C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07\n        M7.1,18.32C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,16.87L7.1,18.32\n        M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13\n        M7.11,8.53L5.7,7.11C4.8,8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z"></path>\n      </svg>',rotateRight:'<svg viewBox="0 0 24 24" class="svg-inline-icon">\n        <path fill="currentColor" d="M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91\n        C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31\n        L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11\n        L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12\n        C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10\n        L15.55,5.55Z"></path>\n      </svg>'},i18n:{minimize:"minimize",maximize:"maximize",close:"close",zoomIn:"zoom-in (+)",zoomOut:"zoom-out (-)",prev:"prev (←)",next:"next (→)",fullscreen:"fullscreen",actualSize:"actual-size (Ctrl+Alt+0)",rotateLeft:"rotate-left (Ctrl+,)",rotateRight:"rotate-right (Ctrl+.)"},multiInstances:!0,initAnimation:!0,fixedModalPos:!1,zIndex:1090,dragHandle:!1,callbacks:{beforeOpen:t.noop,opened:t.noop,beforeClose:t.noop,closed:t.noop,beforeChange:t.noop,changed:t.noop},index:0,progressiveLoading:!0,appendTo:"body",customButtons:{}}}),t("skylark-photoviewer/utilities",["skylark-langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-geom","skylark-domx-images"],function(t,e,o,i,s){"use strict";const n=window.document;return{document:n,throttle:t.debounce,preloadImage:function(t,e,o){s.preload(t).then(function(t){e(t.imgs[0])},o)},requestFullscreen:o.fullscreen,exitFullscreen:o.fullscreen,getImageNameFromUrl:function(t){return t.replace(/^.*?\/*([^/?]*)\.[a-z]+(\?.+|$)/gi,"$1")},hasScrollbar:i.hasScrollbar,getScrollbarWidth:i.scrollbarWidth,setGrabCursor:function(t,e,o,i){const s=i?t.h:t.w,n=i?t.w:t.h;(n>e.h||s>e.w)&&o.addClass("is-grab");n<=e.h&&s<=e.w&&o.removeClass("is-grab")},supportTouch:function(){return e.support.tocuh}}}),t("skylark-photoviewer/constants",["./domq","./utilities"],function(t,e){"use strict";const o=t(window),i=t(e.document),s=e.supportTouch()?"touchstart":"mousedown",n=e.supportTouch()?"touchmove":"mousemove",r=e.supportTouch()?"touchend":"mouseup",a="photoviewer";return{$W:o,$D:i,CLICK_EVENT:"click",RESIZE_EVENT:"resize",KEYDOWN_EVENT:"keydown",WHEEL_EVENT:"wheel mousewheel DOMMouseScroll",TOUCH_START_EVENT:s,TOUCH_MOVE_EVENT:n,TOUCH_END_EVENT:r,NS:a,CLASS_NS:".photoviewer",EVENT_NS:".photoviewer",PUBLIC_VARS:{isMoving:!1,isResizing:!1,zIndex:0}}}),t("skylark-photoviewer/core",["skylark-domx-plugins-pictures/viewer","skylark-domx-plugins-windows/window","./domq","./defaults","./constants","./utilities"],function(t,e,o,i,s,n){"use strict";class r{constructor(t,e,s){this.options=o.extend(!0,{},i,e),e&&o.isArray(e.footerToolbar)&&(this.options.footerToolbar=e.footerToolbar),e&&o.isArray(e.headerToolbar)&&(this.options.headerToolbar=e.headerToolbar),this.$el=o(s),this.isOpened=!1,this.isMaximized=!1,this.isRotated=!1,this.rotateAngle=0,this.isDoResize=!1,this.imageData={},this.modalData={width:null,height:null,left:null,top:null},this.init(t,this.options)}init(t,e){this.groupData=t,this.groupIndex=e.index,s.PUBLIC_VARS.zIndex=0===s.PUBLIC_VARS.zIndex?e.zIndex:s.PUBLIC_VARS.zIndex;const o=t[this.groupIndex].src;this.open(),this.loadImage(o)}_createBtns(t){const e=["minimize","maximize","close","zoomIn","zoomOut","prev","next","fullscreen","actualSize","rotateLeft","rotateRight"];let i="";return o.each(t,(t,o)=>{const n=`${s.NS}-button ${s.NS}-button-${o}`;e.indexOf(o)>=0?i+=`<button class="${n}" title="${this.options.i18n[o]}">\n          ${this.options.icons[o]}\n          </button>`:this.options.customButtons[o]&&(i+=`<button class="${n}" title="${this.options.customButtons[o].title||""}">\n          ${this.options.customButtons[o].text}\n          </button>`)}),i}_createTitle(){return this.options.title?`<div class="${s.NS}-title"></div>`:""}_createTemplate(){const t=`<div class="${s.NS}-modal" tabindex="0">\n        <div class="${s.NS}-inner">\n          <div class="${s.NS}-header">\n            <div class="${s.NS}-toolbar ${s.NS}-toolbar-header">\n            ${this._createBtns(this.options.headerToolbar)}\n            </div>\n            ${this._createTitle()}\n          </div>\n          <div class="${s.NS}-stage">\n            <img class="${s.NS}-image" src="" alt="" />\n          </div>\n          <div class="${s.NS}-footer">\n            <div class="${s.NS}-toolbar ${s.NS}-toolbar-footer">\n            ${this._createBtns(this.options.footerToolbar)}\n            </div>\n          </div>\n        </div>\n      </div>`;return t}build(){const i=this._createTemplate(),n=o(i);this.$photoviewer=n,this.$stage=n.find(s.CLASS_NS+"-stage"),this.$title=n.find(s.CLASS_NS+"-title"),this.$image=n.find(s.CLASS_NS+"-image"),this.$close=n.find(s.CLASS_NS+"-button-close"),this.$maximize=n.find(s.CLASS_NS+"-button-maximize"),this.$minimize=n.find(s.CLASS_NS+"-button-minimize"),this.$zoomIn=n.find(s.CLASS_NS+"-button-zoomIn"),this.$zoomOut=n.find(s.CLASS_NS+"-button-zoomOut"),this.$actualSize=n.find(s.CLASS_NS+"-button-actualSize"),this.$fullscreen=n.find(s.CLASS_NS+"-button-fullscreen"),this.$rotateLeft=n.find(s.CLASS_NS+"-button-rotateLeft"),this.$rotateRight=n.find(s.CLASS_NS+"-button-rotateRight"),this.$prev=n.find(s.CLASS_NS+"-button-prev"),this.$next=n.find(s.CLASS_NS+"-button-next"),this.$stage.addClass("stage-ready"),this.$image.addClass("image-ready"),this.$photoviewer.css("z-index",s.PUBLIC_VARS.zIndex),this.options.dragHandle&&this.options.dragHandle!==s.CLASS_NS+"-modal"?this.dragHandle=this.$photoviewer.find(this.options.dragHandle):this.dragHandle=this.$photoviewer,o(this.options.appendTo).eq(0).append(this.$photoviewer),this._window=new e(this.$photoviewer[0],{selectors:{headerPane:"",contentPane:"",footerPane:"",titlebar:"",buttons:{fullscreen:".photoviewer-button-fullscreen",maximize:".photoviewer-button-maximize",minimize:".photoviewer-button-minimize",close:".photoviewer-button-close"}},classes:{maximize:s.NS+"-maximize"},fixedContent:!0,initMaximized:!1,movable:{dragHandle:this.options.dragHandle,dragCancel:s.CLASS_NS+"-button"},resizable:{minWidth:320,minHeight:320,border:{classes:{all:`${s.NS}-resizable-handle`,top:`${s.NS}-resizable-handle-n`,left:`${s.NS}-resizable-handle-w`,right:`${s.NS}-resizable-handle-e`,bottom:`${s.NS}-resizable-handle-s`,topLeft:`${s.NS}-resizable-handle-nw`,topRight:`${s.NS}-resizable-handle-ne`,bottomLeft:`${s.NS}-resizable-handle-sw`,bottomRight:`${s.NS}-resizable-handle-se`}}}}),this._imager=new t(this.$stage[0],{ratioThreshold:this.options.ratioThreshold,minRatio:this.options.minRatio,maxRatio:this.options.maxRatio,movable:!0,classes:{grab:"is-grab",loader:"${ Constants.NS }-loader"}}),this._addEvents(),this._addCustomButtonEvents(),this.$photoviewer.on("resized",()=>{this._imager.resize()})}open(){if(this._triggerHook("beforeOpen",this),this.options.multiInstances||o(s.CLASS_NS+"-modal").eq(0).remove(),!o(s.CLASS_NS+"-modal").length&&this.options.fixedContent&&(o("html").css({overflow:"hidden"}),n.hasScrollbar())){const t=n.getScrollbarWidth();t&&o("html").css({"padding-right":t})}this.build(),this.setModalPos(this.$photoviewer),this.$photoviewer.get(0).focus(),this._triggerHook("opened",this)}close(){this._window.close()}setModalPos(t){const e=s.$W.width(),o=s.$W.height(),i=s.$D.scrollLeft(),n=s.$D.scrollTop(),r=this.options.modalWidth,a=this.options.modalHeight;this.options.initMaximized?(t.addClass(s.NS+"-maximize"),t.css({width:"100%",height:"100%",left:0,top:0}),this.isOpened=!0,this.isMaximized=!0):t.css({width:r,height:a,left:(e-r)/2+i+"px",top:(o-a)/2+n+"px"})}setModalSize(t){const e=s.$W.width(),o=s.$W.height(),i=s.$D.scrollLeft(),n=s.$D.scrollTop(),r={left:this.$stage.css("left"),right:this.$stage.css("right"),top:this.$stage.css("top"),bottom:this.$stage.css("bottom"),borderLeft:this.$stage.css("border-left-width"),borderRight:this.$stage.css("border-right-width"),borderTop:this.$stage.css("border-top-width"),borderBottom:this.$stage.css("border-bottom-width")},a=t.width+parseFloat(r.left)+parseFloat(r.right)+parseFloat(r.borderLeft)+parseFloat(r.borderRight),h=t.height+parseFloat(r.top)+parseFloat(r.bottom)+parseFloat(r.borderTop)+parseFloat(r.borderBottom),l=(this.options.gapThreshold>0?this.options.gapThreshold:0)+1,d=Math.min(e/(a*l),o/(h*l),1);let p=Math.max(a*d,this.options.modalWidth),c=Math.max(h*d,this.options.modalHeight);p=this.options.fixedModalSize?this.options.modalWidth:Math.round(p),c=this.options.fixedModalSize?this.options.modalHeight:Math.round(c);const u={width:p+"px",height:c+"px",left:(e-p)/2+i+"px",top:(o-c)/2+n+"px"};this.options.initAnimation?this.$photoviewer.animate(u,400,"ease-in-out",()=>{this.setImageSize(t)}):(this.$photoviewer.css(u),this.setImageSize(t)),this.isOpened=!0}setImageSize(t){this._imager.setImageSize(t)}loadImage(t,e,o){this._imager.loadImage(t,t=>{this.setModalSize(t),e&&e.call()},o),this.options.title&&this.setImageTitle(t)}setImageTitle(t){const e=this.groupData[this.groupIndex].title||n.getImageNameFromUrl(t);this.$title.html(e)}jump(t){this._triggerHook("beforeChange",[this,this.groupIndex]),this.groupIndex=this.groupIndex+t,this.jumpTo(this.groupIndex)}jumpTo(t){(t%=this.groupData.length)>=0?t%=this.groupData.length:t<0&&(t=(this.groupData.length+t)%this.groupData.length),this.groupIndex=t,this.loadImage(this.groupData[t].src,()=>{this._triggerHook("changed",[this,t])},()=>{this._triggerHook("changed",[this,t])})}zoom(t,e,o){this._imager.zoom(t,e,o)}zoomTo(t,e,o){this._imager.zoomTo(t,e,o)}rotate(t){this._imager.rotate(t)}rotateTo(t){this._imager.rotateTo(t)}resize(){return this._imager.resize()}maximize(){this._window.maximize()}fullscreen(){this._window.fullscreen()}_keydown(t){if(!this.options.keyboard)return!1;const e=t.keyCode||t.which||t.charCode;t.ctrlKey||t.metaKey,t.altKey||t.metaKey;switch(e){case 37:this.jump(-1);break;case 39:this.jump(1);break;case 81:this.close()}}_addEvents(){this.$zoomIn.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoom(3*this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$zoomOut.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoom(3*-this.options.ratioThreshold,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$actualSize.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,t=>{this.zoomTo(1,{x:this.$stage.width()/2,y:this.$stage.height()/2},t)}),this.$prev.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.jump(-1)}),this.$next.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.jump(1)}),this.$rotateLeft.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.rotate(-90)}),this.$rotateRight.off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,()=>{this.rotate(90)}),this.$photoviewer.off(s.KEYDOWN_EVENT+s.EVENT_NS).on(s.KEYDOWN_EVENT+s.EVENT_NS,t=>{this._keydown(t)})}_addCustomButtonEvents(){for(const t in this.options.customButtons)this.$photoviewer.find(s.CLASS_NS+"-button-"+t).off(s.CLICK_EVENT+s.EVENT_NS).on(s.CLICK_EVENT+s.EVENT_NS,e=>{this.options.customButtons[t].click.apply(this,[this,e])})}_triggerHook(t,e){this.options.callbacks[t]&&this.options.callbacks[t].apply(this,o.isArray(e)?e:[e])}}return window.PhotoViewer=r,r}),t("skylark-photoviewer/main",["./core"],function(t){"use strict";return t}),t("skylark-photoviewer",["skylark-photoviewer/main"],function(t){return t})}(o),!i){var r=require("skylark-langx-ns");s?module.exports=r:e.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-photoviewer.js.map
